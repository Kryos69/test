-- 124

local SpareStackLib = {}
SpareStackLib.__index = SpareStackLib

local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")

-- Helper function to create instances
local function createInstance(className, properties)
	local instance = Instance.new(className)
	for k, v in pairs(properties) do
		if typeof(k) ~= 'string' then
			continue
		end
		instance[k] = v
	end
	return instance
end

-- Toggle Component
local Toggle = {}
Toggle.__index = Toggle

function Toggle.new(parent, title, defaultValue, callback)
	local self = setmetatable({}, Toggle)
	
	self.Value = defaultValue or false
	self.Callback = callback or function() end
	
	-- Create toggle UI
	self.Container = createInstance("TextLabel", {
		Name = "Toggle_" .. title,
		Size = UDim2.new(0, 310, 0, 50),
		Parent = parent,
		BackgroundTransparency = 1,
		Font = Enum.Font.GothamBold,
		Text = title,
		TextXAlignment = Enum.TextXAlignment.Left,
		TextYAlignment = Enum.TextYAlignment.Center,
		TextColor3 = Color3.fromRGB(255, 255, 255),
		TextSize = 14,
		ZIndex = 1
	})
	
	-- Settings icon (optional)
	self.SettingsIcon = createInstance("ImageButton", {
		Name = "Settings",
		Position = UDim2.new(0.890, 0, 0.493, 0),
		Size = UDim2.new(0, 15, 0, 15),
		Parent = self.Container,
		BackgroundTransparency = 1,
		AnchorPoint = Vector2.new(0.5, 0.5),
		ImageColor3 = Color3.fromRGB(46, 46, 66),
		Image = "rbxassetid://70543102142774",
		ZIndex = 1
	})
	
	-- Toggle background
	self.Background = createInstance("TextButton", {
		Name = "ToggleBackground",
		Position = UDim2.new(0.942, 0, 0.300, 0),
		Size = UDim2.new(0, 35, 0, 20),
		Parent = self.Container,
		Text = '',
		BackgroundColor3 = Color3.fromRGB(28, 48, 103),
		BorderSizePixel = 0,
		ZIndex = 1
	})
	
	createInstance("UICorner", {
		Parent = self.Background,
		CornerRadius = UDim.new(1, 0)
	})
	
	-- Toggle orb
	self.Orb = createInstance("Frame", {
		Name = "ToggleOrb",
		Position = UDim2.new(0.2, 0, 0.5, 0),
		Size = UDim2.new(0, 13, 0, 13),
		Parent = self.Background,
		AnchorPoint = Vector2.new(0.5, 0.5),
		BackgroundColor3 = Color3.fromRGB(51, 105, 255),
		BorderSizePixel = 0,
		ZIndex = 2
	})
	
	createInstance("UICorner", {
		Parent = self.Orb,
		CornerRadius = UDim.new(1, 0)
	})
	
	-- Set initial state
	self:SetValue(self.Value, true)
	
	-- Connect toggle functionality
	self.Background.MouseButton1Click:Connect(function()
		self:Toggle()
	end)
	
	return self
end

function Toggle:Toggle()
	self:SetValue(not self.Value)
end

function Toggle:SetValue(value, skipCallback)
	self.Value = value
	
	local tweenInfo = TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
	
	if self.Value then
		-- ON state
		TweenService:Create(self.Orb, tweenInfo, {
			Position = UDim2.new(0.8, 0, 0.5, 0)
		}):Play()
		TweenService:Create(self.Background, tweenInfo, {
			BackgroundColor3 = Color3.fromRGB(51, 105, 255)
		}):Play()
	else
		-- OFF state
		TweenService:Create(self.Orb, tweenInfo, {
			Position = UDim2.new(0.2, 0, 0.5, 0)
		}):Play()
		TweenService:Create(self.Background, tweenInfo, {
			BackgroundColor3 = Color3.fromRGB(28, 48, 103)
		}):Play()
	end
	
	if not skipCallback then
		self.Callback(self.Value)
	end
end

function Toggle:Destroy()
	self.Container:Destroy()
end

-- Slider Component
local Slider = {}
Slider.__index = Slider

function Slider.new(parent, title, min, max, defaultValue, callback)
	local self = setmetatable({}, Slider)
	
	self.Min = min or 0
	self.Max = max or 100
	self.Value = defaultValue or self.Min
	self.Callback = callback or function() end
	self.Dragging = false
	
	-- Create slider UI
	self.Container = createInstance("TextLabel", {
		Name = "Slider_" .. title,
		Size = UDim2.new(0, 310, 0, 50),
		Parent = parent,
		BackgroundTransparency = 1,
		Font = Enum.Font.GothamBold,
		Text = title,
		TextXAlignment = Enum.TextXAlignment.Left,
		TextYAlignment = Enum.TextYAlignment.Center,
		TextColor3 = Color3.fromRGB(255, 255, 255),
		TextSize = 14,
		ZIndex = 1
	})
	
	-- Bar background
	self.Bar = createInstance("Frame", {
		Name = "SliderBar",
		Position = UDim2.new(0.523, 0, 0.908, 0),
		Size = UDim2.new(0, 318, 0, 9),
		Parent = self.Container,
		AnchorPoint = Vector2.new(0.5, 0.5),
		BackgroundColor3 = Color3.fromRGB(21, 21, 27),
		BorderSizePixel = 0,
		ZIndex = 1
	})
	
	createInstance("UICorner", {
		Parent = self.Bar
	})
	
	-- Fill
	self.Fill = createInstance("Frame", {
		Name = "Fill",
		Position = UDim2.new(0, 0, 0.5, 0),
		Size = UDim2.new(0, 30, 0, 9),
		Parent = self.Bar,
		AnchorPoint = Vector2.new(0, 0.5),
		BackgroundColor3 = Color3.fromRGB(51, 105, 255),
		BorderSizePixel = 0,
		ZIndex = 0
	})
	
	createInstance("UICorner", {
		Parent = self.Fill
	})
	
	-- Handle
	self.Handle = createInstance("TextButton", {
		Name = "Handle",
		Position = UDim2.new(0, 0, 0.5, 0),
		Size = UDim2.new(0, 21, 0, 21),
		Parent = self.Bar,
		AnchorPoint = Vector2.new(0.5, 0.5),
		Text = '',
		BackgroundColor3 = Color3.fromRGB(255, 255, 255),
		BorderSizePixel = 0,
		ZIndex = 2
	})
	
	createInstance("UICorner", {
		Parent = self.Handle,
		CornerRadius = UDim.new(1, 0)
	})
	
	-- Set initial value
	self:SetValue(self.Value, true)
	
	-- Connect dragging functionality
	self.Handle.MouseButton1Down:Connect(function()
		self.Dragging = true
	end)
	
	UserInputService.InputEnded:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 then
			self.Dragging = false
		end
	end)
	
	UserInputService.InputChanged:Connect(function(input)
		if self.Dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
			self:UpdateFromMouse()
		end
	end)
	
	self.Bar.MouseButton1Down:Connect(function()
		self:UpdateFromMouse()
	end)
	
	return self
end

function Slider:UpdateFromMouse()
	local mouse = UserInputService:GetMouseLocation()
	local barPos = self.Bar.AbsolutePosition
	local barSize = self.Bar.AbsoluteSize
	
	local relativeX = math.clamp(mouse.X - barPos.X, 0, barSize.X)
	local percentage = relativeX / barSize.X
	
	local newValue = self.Min + (self.Max - self.Min) * percentage
	self:SetValue(newValue)
end

function Slider:SetValue(value, skipCallback)
	self.Value = math.clamp(value, self.Min, self.Max)
	
	local percentage = (self.Value - self.Min) / (self.Max - self.Min)
	
	-- Update fill
	self.Fill.Size = UDim2.new(percentage, 0, 0, 9)
	
	-- Update handle position
	self.Handle.Position = UDim2.new(percentage, 0, 0.5, 0)
	
	if not skipCallback then
		self.Callback(self.Value)
	end
end

function Slider:Destroy()
	self.Container:Destroy()
end

-- Card Component
local Card = {}
Card.__index = Card

function Card.new(parent, title, icon)
	local self = setmetatable({}, Card)
	
	self.Components = {}
	self.ComponentYOffset = 0.148
	
	-- Create card frame
	self.Frame = createInstance("Frame", {
		Name = "Card_" .. title,
		Size = UDim2.new(0, 356, 0, 337),
		Parent = parent,
		BackgroundTransparency = 1,
		BackgroundColor3 = Color3.fromRGB(255, 255, 255),
		BorderSizePixel = 0,
		ZIndex = 1
	})
	
	-- Icon
	if icon then
		self.Icon = createInstance("ImageLabel", {
			Name = "Icon",
			Position = UDim2.new(0.045, 0, 0.045, 0),
			Size = UDim2.new(0, 20, 0, 20),
			Parent = self.Frame,
			BackgroundTransparency = 1,
			ImageColor3 = Color3.fromRGB(255, 255, 255),
			Image = icon,
			ZIndex = 1
		})
	end
	
	-- Background
	self.Background = createInstance("ImageLabel", {
		Name = "Background",
		Position = UDim2.new(0, 0, 0.148, 0),
		Size = UDim2.new(0, 356, 0, 289),
		Parent = self.Frame,
		BackgroundTransparency = 1,
		ImageColor3 = Color3.fromRGB(255, 255, 255),
		Image = "rbxassetid://79172856971491",
		ZIndex = 0
	})
	
	-- Title bar (Placard)
	self.Placard = createInstance("ImageLabel", {
		Name = "Placard",
		Position = UDim2.new(0, 0, 0, 0),
		Size = UDim2.new(0, 356, 0, 50),
		Parent = self.Frame,
		BackgroundTransparency = 1,
		ImageColor3 = Color3.fromRGB(255, 255, 255),
		Image = "rbxassetid://91296368223791",
		ZIndex = 0
	})
	
	-- Card title
	self.CardTitle = createInstance("TextLabel", {
		Name = "CardTitle",
		Position = UDim2.new(0.129, 0, 0, 0),
		Size = UDim2.new(0, 310, 0, 50),
		Parent = self.Frame,
		BackgroundTransparency = 1,
		Font = Enum.Font.GothamBold,
		Text = title,
		TextXAlignment = Enum.TextXAlignment.Left,
		TextYAlignment = Enum.TextYAlignment.Center,
		TextColor3 = Color3.fromRGB(255, 255, 255),
		TextSize = 14,
		ZIndex = 1
	})
	
	-- Container for components
	self.ComponentContainer = createInstance("Frame", {
		Name = "Components",
		Position = UDim2.new(0.045, 0, 0.148, 0),
		Size = UDim2.new(0, 310, 0, 289),
		Parent = self.Frame,
		BackgroundTransparency = 1,
		ZIndex = 1
	})
	
	return self
end

function Card:AddToggle(title, defaultValue, callback)
	local toggle = Toggle.new(self.ComponentContainer, title, defaultValue, callback)
	toggle.Container.Position = UDim2.new(0, 0, self.ComponentYOffset, 0)
	
	self.ComponentYOffset = self.ComponentYOffset + 0.18
	table.insert(self.Components, toggle)
	
	-- Resize card if needed
	self:UpdateSize()
	
	return toggle
end

function Card:AddSlider(title, min, max, defaultValue, callback)
	local slider = Slider.new(self.ComponentContainer, title, min, max, defaultValue, callback)
	slider.Container.Position = UDim2.new(0, 0, self.ComponentYOffset, 0)
	
	self.ComponentYOffset = self.ComponentYOffset + 0.18
	table.insert(self.Components, slider)
	
	-- Resize card if needed
	self:UpdateSize()
	
	return slider
end

function Card:UpdateSize()
	local componentCount = #self.Components
	local newHeight = 150 + (componentCount * 60)
	self.Frame.Size = UDim2.new(0, 356, 0, math.max(337, newHeight))
	self.Background.Size = UDim2.new(0, 356, 0, math.max(289, newHeight - 48))
	self.ComponentContainer.Size = UDim2.new(0, 310, 0, math.max(289, newHeight - 48))
end

function Card:Destroy()
	for _, component in ipairs(self.Components) do
		component:Destroy()
	end
	self.Frame:Destroy()
end

-- Main Library
function SpareStackLib.new()
	local self = setmetatable({}, SpareStackLib)
	
	self.Tabs = {}
	self.CurrentTab = nil
	
	-- Create base UI automatically
	self.ScreenGui = Instance.new("ScreenGui", game:GetService("CoreGui"))
	self.ScreenGui.Name = "SpareStack_" .. math.random(1000, 9999)
	self.ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
	self.ScreenGui.ResetOnSpawn = false
	
	-- Background
	self.Background = createInstance("ImageLabel", {
		Name = "Background",
		Position = UDim2.new(0.269, 0, 0.230, 0),
		Size = UDim2.new(0, 1011, 0, 630),
		Parent = self.ScreenGui,
		BackgroundTransparency = 1,
		BackgroundColor3 = Color3.fromRGB(255, 255, 255),
		ImageColor3 = Color3.fromRGB(255, 255, 255),
		Image = "rbxassetid://71105506054247",
		BorderSizePixel = 0,
		ZIndex = 0,
		Active = true,
		Draggable = true
	})
	
	createInstance("UIPadding", {
		Parent = self.Background,
		PaddingLeft = UDim.new(0, 10)
	})
	
	-- Search Holder
	local SearchHolder = createInstance("Frame", {
		Name = "SearchHolder",
		Position = UDim2.new(0.252, 0, 0.019, 0),
		Size = UDim2.new(0, 198, 0, 40),
		Parent = self.Background,
		BackgroundTransparency = 1,
		BorderSizePixel = 0,
		ZIndex = 1
	})
	
	-- Search Box
	self.SearchBox = createInstance("TextBox", {
		Name = "Search",
		Position = UDim2.new(-0.001, 0, -0.006, 0),
		Size = UDim2.new(0, 200, 0, 40),
		Parent = SearchHolder,
		Font = Enum.Font.SourceSansSemibold,
		Text = 'Search . . .',
		TextXAlignment = Enum.TextXAlignment.Left,
		TextYAlignment = Enum.TextYAlignment.Center,
		TextColor3 = Color3.fromRGB(255, 255, 255),
		PlaceholderText = '',
		PlaceholderColor3 = Color3.fromRGB(178, 178, 178),
		BackgroundColor3 = Color3.fromRGB(20, 20, 27),
		TextSize = 14,
		BorderSizePixel = 0,
		ZIndex = 1
	})
	
	createInstance("UIPadding", {
		Parent = self.SearchBox,
		PaddingLeft = UDim.new(0, 15)
	})
	
	createInstance("UICorner", {
		Parent = self.SearchBox,
		CornerRadius = UDim.new(0, 3)
	})
	
	createInstance("ImageLabel", {
		Name = "SearchIcon",
		Position = UDim2.new(0.805, 0, 0.300, 0),
		Size = UDim2.new(0, 15, 0, 15),
		Parent = self.SearchBox,
		BackgroundTransparency = 1,
		ImageColor3 = Color3.fromRGB(255, 255, 255),
		Image = "rbxassetid://105544331892424",
		BorderSizePixel = 0,
		ZIndex = 1
	})
	
	createInstance("UICorner", {
		Parent = SearchHolder,
		CornerRadius = UDim.new(0, 3)
	})
	
	local searchStroke = createInstance("UIStroke", {
		Parent = SearchHolder,
		Color = Color3.fromRGB(22, 22, 30),
		Thickness = 2,
		LineJoinMode = Enum.LineJoinMode.Round,
		Transparency = 0
	})
	
	-- Settings Button
	local Settings = createInstance("TextButton", {
		Name = "Settings",
		Position = UDim2.new(0.930, 0, 0.017, 0),
		Size = UDim2.new(0, 45, 0, 45),
		Parent = self.Background,
		Font = Enum.Font.SourceSans,
		Text = '',
		BackgroundColor3 = Color3.fromRGB(20, 20, 27),
		TextSize = 14,
		BorderSizePixel = 0,
		ZIndex = 1
	})
	
	createInstance("UICorner", {
		Parent = Settings,
		CornerRadius = UDim.new(0, 3)
	})
	
	createInstance("ImageButton", {
		Name = "SettingsIcon",
		Position = UDim2.new(0.256, 0, 0.284, 0),
		Size = UDim2.new(0, 20, 0, 20),
		Parent = Settings,
		BackgroundTransparency = 1,
		ImageColor3 = Color3.fromRGB(255, 255, 255),
		Image = "rbxassetid://70543102142774",
		BorderSizePixel = 0,
		ZIndex = 1
	})
	
	local settingsStroke = createInstance("Frame", {
		Name = "Stroke",
		Size = UDim2.new(0, 45, 0, 45),
		Parent = Settings,
		BackgroundTransparency = 1,
		BorderSizePixel = 0,
		ZIndex = 1
	})
	
	createInstance("UIStroke", {
		Parent = settingsStroke,
		Color = Color3.fromRGB(22, 22, 30),
		Thickness = 2,
		LineJoinMode = Enum.LineJoinMode.Round,
		Transparency = 0
	})
	
	createInstance("UICorner", {
		Parent = settingsStroke,
		CornerRadius = UDim.new(0, 3)
	})
	
	-- Card Holder (ScrollingFrame)
	self.CardHolder = createInstance("ScrollingFrame", {
		Name = "CardHolder",
		Position = UDim2.new(0.385, 0, 0.301, 0),
		Size = UDim2.new(0, 745, 0, 537),
		Parent = self.ScreenGui,
		BackgroundTransparency = 1,
		ScrollBarThickness = 7,
		ClipsDescendants = true,
		BorderSizePixel = 0,
		ZIndex = 1,
		ScrollBarImageColor3 = Color3.fromRGB(51, 105, 255)
	})
	
	-- Setup search functionality
	self.SearchBox:GetPropertyChangedSignal("Text"):Connect(function()
		self:FilterTabs(self.SearchBox.Text)
	end)
	
	self.SearchBox.Focused:Connect(function()
		if self.SearchBox.Text == "Search . . ." then
			self.SearchBox.Text = ""
		end
	end)
	
	self.SearchBox.FocusLost:Connect(function()
		if self.SearchBox.Text == "" then
			self.SearchBox.Text = "Search . . ."
		end
	end)
	
	-- Close button
	local CloseButton = createInstance("TextButton", {
		Name = "Close",
		Position = UDim2.new(0.015, 0, 0.017, 0),
		Size = UDim2.new(0, 45, 0, 45),
		Parent = self.Background,
		Font = Enum.Font.GothamBold,
		Text = "X",
		TextColor3 = Color3.fromRGB(255, 255, 255),
		BackgroundColor3 = Color3.fromRGB(20, 20, 27),
		TextSize = 18,
		BorderSizePixel = 0,
		ZIndex = 1
	})
	
	createInstance("UICorner", {
		Parent = CloseButton,
		CornerRadius = UDim.new(0, 3)
	})
	
	local closeStroke = createInstance("Frame", {
		Name = "Stroke",
		Size = UDim2.new(0, 45, 0, 45),
		Parent = CloseButton,
		BackgroundTransparency = 1,
		BorderSizePixel = 0,
		ZIndex = 1
	})
	
	createInstance("UIStroke", {
		Parent = closeStroke,
		Color = Color3.fromRGB(22, 22, 30),
		Thickness = 2,
		LineJoinMode = Enum.LineJoinMode.Round,
		Transparency = 0
	})
	
	createInstance("UICorner", {
		Parent = closeStroke,
		CornerRadius = UDim.new(0, 3)
	})
	
	CloseButton.MouseButton1Click:Connect(function()
		self.ScreenGui:Destroy()
	end)
	
	return self
end

function SpareStackLib:FilterTabs(searchText)
	searchText = searchText:lower()
	
	for _, tab in ipairs(self.Tabs) do
		local tabTitle = tab.CardTitle.Text:lower()
		
		if searchText == "" or searchText == "search . . ." or tabTitle:find(searchText, 1, true) then
			tab.Frame.Visible = true
		else
			tab.Frame.Visible = false
		end
	end
end

function SpareStackLib:CreateTab(title, icon)
	local card = Card.new(self.CardHolder, title, icon)
	table.insert(self.Tabs, card)
	
	-- Auto-layout cards in a grid
	self:LayoutTabs()
	
	return card
end

function SpareStackLib:LayoutTabs()
	local cardWidth = 356
	local cardSpacing = 20
	local cardsPerRow = 2
	
	for i, card in ipairs(self.Tabs) do
		local row = math.floor((i - 1) / cardsPerRow)
		local col = (i - 1) % cardsPerRow
		
		card.Frame.Position = UDim2.new(
			0,
			col * (cardWidth + cardSpacing),
			0,
			row * 360
		)
	end
	
	-- Update canvas size
	local totalRows = math.ceil(#self.Tabs / cardsPerRow)
	self.CardHolder.CanvasSize = UDim2.new(0, 0, 0, totalRows * 360)
end

return SpareStackLib
