
local SpareStackLib = {}
SpareStackLib.__index = SpareStackLib

local TweenService = game:GetService("TweenService")
local UIS = game:GetService("UserInputService")
local Players = game:GetService("Players")

function SpareStackLib:CreateWindow(title)
	local self = setmetatable({}, SpareStackLib)
	
	-- Instances
	local Sparestack = Instance.new("ScreenGui")
	local Background = Instance.new("ImageLabel")
	local UIPadding = Instance.new("UIPadding")
	local SearchHolder = Instance.new("Frame")
	local Search = Instance.new("TextBox")
	local UIPadding_1 = Instance.new("UIPadding")
	local UICorner = Instance.new("UICorner")
	local ImageLabel = Instance.new("ImageLabel")
	local UICorner_2 = Instance.new("UICorner")
	local Settings = Instance.new("TextButton")
	local UICorner_3 = Instance.new("UICorner")
	local Image = Instance.new("ImageButton")
	local uistroke = Instance.new("Frame")
	local UICorner_5 = Instance.new("UICorner")
	local CardHolder = Instance.new("ScrollingFrame")
	local UIListLayout_2 = Instance.new("UIListLayout")
	local Title_3 = Instance.new("ImageLabel")
	local SideHolder = Instance.new("Frame")
	local CategoryText = Instance.new("TextLabel")
	
	-- Properties
	Sparestack.Name = "Spare stack"
	Sparestack.Parent = Players.LocalPlayer:WaitForChild("PlayerGui")
	Sparestack.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
	Sparestack.ResetOnSpawn = false
	
	Background.Name = "Background"
	Background.Parent = Sparestack
	Background.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
	Background.BackgroundTransparency = 1.000
	Background.BorderColor3 = Color3.fromRGB(0, 0, 0)
	Background.BorderSizePixel = 0
	Background.Position = UDim2.new(0.268949777, 0, 0.23030822, 0)
	Background.Size = UDim2.new(0, 1011, 0, 630)
	Background.ZIndex = 0
	Background.Image = "rbxassetid://71105506054247"
	
	UIPadding.Parent = Background
	UIPadding.PaddingLeft = UDim.new(0, 10)
	
	SearchHolder.Name = "SearchHolder"
	SearchHolder.Parent = Background
	SearchHolder.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
	SearchHolder.BackgroundTransparency = 1.000
	SearchHolder.BorderColor3 = Color3.fromRGB(0, 0, 0)
	SearchHolder.BorderSizePixel = 0
	SearchHolder.Position = UDim2.new(0.252460182, 0, 0.0190476198, 0)
	SearchHolder.Size = UDim2.new(0, 198, 0, 40)
	
	Search.Name = "Search"
	Search.Parent = SearchHolder
	Search.BackgroundColor3 = Color3.fromRGB(20, 20, 27)
	Search.BorderColor3 = Color3.fromRGB(0, 0, 0)
	Search.BorderSizePixel = 0
	Search.Position = UDim2.new(-0.00128882821, 0, -0.00595245371, 0)
	Search.Size = UDim2.new(0, 200, 0, 40)
	Search.Font = Enum.Font.SourceSansSemibold
	Search.PlaceholderText = "Search . . ."
	Search.Text = ""
	Search.TextColor3 = Color3.fromRGB(255, 255, 255)
	Search.TextSize = 14.000
	Search.TextXAlignment = Enum.TextXAlignment.Left
	Search.ClearTextOnFocus = false
	
	UIPadding_1.Name = "UIPadding_1"
	UIPadding_1.Parent = Search
	UIPadding_1.PaddingLeft = UDim.new(0, 15)
	
	UICorner.CornerRadius = UDim.new(0, 3)
	UICorner.Parent = Search
	
	ImageLabel.Parent = Search
	ImageLabel.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
	ImageLabel.BackgroundTransparency = 1.000
	ImageLabel.BorderColor3 = Color3.fromRGB(0, 0, 0)
	ImageLabel.BorderSizePixel = 0
	ImageLabel.Position = UDim2.new(0.805405378, 0, 0.300000012, 0)
	ImageLabel.Size = UDim2.new(0, 15, 0, 15)
	ImageLabel.Image = "rbxassetid://105544331892424"
	
	UICorner_2.CornerRadius = UDim.new(0, 3)
	UICorner_2.Name = "UICorner_2"
	UICorner_2.Parent = SearchHolder
	
	Settings.Name = "Settings"
	Settings.Parent = Background
	Settings.BackgroundColor3 = Color3.fromRGB(20, 20, 27)
	Settings.BorderColor3 = Color3.fromRGB(0, 0, 0)
	Settings.BorderSizePixel = 0
	Settings.Position = UDim2.new(0.930000007, 0, 0.0170000009, 0)
	Settings.Size = UDim2.new(0, 45, 0, 45)
	Settings.Font = Enum.Font.SourceSans
	Settings.Text = ""
	Settings.TextColor3 = Color3.fromRGB(0, 0, 0)
	Settings.TextSize = 14.000
	
	UICorner_3.CornerRadius = UDim.new(0, 3)
	UICorner_3.Name = "UICorner_3"
	UICorner_3.Parent = Settings
	
	Image.Name = "Image"
	Image.Parent = Settings
	Image.BackgroundColor3 = Color3.fromRGB(20, 20, 27)
	Image.BackgroundTransparency = 1.000
	Image.BorderColor3 = Color3.fromRGB(0, 0, 0)
	Image.BorderSizePixel = 0
	Image.Position = UDim2.new(0.255647779, 0, 0.284126788, 0)
	Image.Size = UDim2.new(0, 20, 0, 20)
	Image.Image = "rbxassetid://70543102142774"
	
	uistroke.Name = "uistroke"
	uistroke.Parent = Settings
	uistroke.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
	uistroke.BackgroundTransparency = 1.000
	uistroke.BorderColor3 = Color3.fromRGB(0, 0, 0)
	uistroke.BorderSizePixel = 0
	uistroke.Size = UDim2.new(0, 45, 0, 45)
	
	UICorner_5.CornerRadius = UDim.new(0, 3)
	UICorner_5.Name = "UICorner_5"
	UICorner_5.Parent = uistroke
	
	CardHolder.Name = "CardHolder"
	CardHolder.Parent = Sparestack
	CardHolder.Active = true
	CardHolder.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
	CardHolder.BackgroundTransparency = 1.000
	CardHolder.BorderColor3 = Color3.fromRGB(0, 0, 0)
	CardHolder.BorderSizePixel = 0
	CardHolder.Position = UDim2.new(0.385388136, 0, 0.300513685, 0)
	CardHolder.Size = UDim2.new(0, 745, 0, 537)
	CardHolder.ScrollBarThickness = 7
	CardHolder.CanvasSize = UDim2.new(0, 0, 0, 0)
	
	UIListLayout_2.Parent = CardHolder
	UIListLayout_2.FillDirection = Enum.FillDirection.Horizontal
	UIListLayout_2.SortOrder = Enum.SortOrder.LayoutOrder
	UIListLayout_2.Padding = UDim.new(0.0299999993, 0)
	
	UIListLayout_2:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
		CardHolder.CanvasSize = UDim2.new(CardHolder.CanvasSize.X.Scale, CardHolder.CanvasSize.X.Offset, 0, UIListLayout_2.AbsoluteContentSize.Y + 20)
	end)
	
	Title_3.Name = "Title"
	Title_3.Parent = Sparestack
	Title_3.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
	Title_3.BackgroundTransparency = 1.000
	Title_3.BorderColor3 = Color3.fromRGB(0, 0, 0)
	Title_3.BorderSizePixel = 0
	Title_3.Position = UDim2.new(0.278082192, 0, 0.24229452, 0)
	Title_3.Size = UDim2.new(0, 200, 0, 40)
	Title_3.ZIndex = 0
	Title_3.Image = "rbxassetid://117733299243150"
	
	SideHolder.Name = "SideHolder"
	SideHolder.Parent = Sparestack
	SideHolder.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
	SideHolder.BackgroundTransparency = 1.000
	SideHolder.BorderColor3 = Color3.fromRGB(0, 0, 0)
	SideHolder.BorderSizePixel = 0
	SideHolder.Position = UDim2.new(0.278209239, 0, 0.303746015, 0)
	SideHolder.Size = UDim2.new(0, 200, 0, 490)
	
	CategoryText.Name = "CategoryText"
	CategoryText.Parent = SideHolder
	CategoryText.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
	CategoryText.BackgroundTransparency = 1.000
	CategoryText.BorderColor3 = Color3.fromRGB(0, 0, 0)
	CategoryText.BorderSizePixel = 0
	CategoryText.Position = UDim2.new(-0.00499999989, 0, -0.00816326495, 0)
	CategoryText.Size = UDim2.new(0, 186, 0, 31)
	CategoryText.Font = Enum.Font.GothamBold
	CategoryText.Text = "General"
	CategoryText.TextColor3 = Color3.fromRGB(58, 58, 73)
	CategoryText.TextSize = 14.000
	CategoryText.TextXAlignment = Enum.TextXAlignment.Left
	
	self.Gui = Sparestack
	self.Background = Background
	self.SideHolder = SideHolder
	self.CardHolder = CardHolder
	self.SearchBox = Search
	self.CategoryText = CategoryText
	self.Cards = {}
	self.Tabs = {}
	self.TabButtons = {}
	self.CurrentTab = nil
	
	-- Search functionality
	Search:GetPropertyChangedSignal("Text"):Connect(function()
		self:FilterCards(Search.Text:lower())
	end)
	
	return self
end

-- Filter cards based on search
function SpareStackLib:FilterCards(query)
	for _, card in pairs(self.Cards) do
		if query == "" then
			if card:GetAttribute("Tab") == self.CurrentTab then
				card.Visible = true
			end
		else
			local cardTitle = card:FindFirstChild("CardTitle")
			if cardTitle and string.find(cardTitle.Text:lower(), query) and card:GetAttribute("Tab") == self.CurrentTab then
				card.Visible = true
			else
				card.Visible = false
			end
		end
	end
end

-- Create a tab
function SpareStackLib:CreateTab(tabName, tabImage)
	local tabIndex = #self.TabButtons
	
	-- Tab Button
	local Tab = Instance.new("Frame")
	Tab.Name = "Tab"
	Tab.Parent = self.SideHolder
	Tab.BackgroundColor3 = Color3.fromRGB(20, 20, 27)
	Tab.BorderColor3 = Color3.fromRGB(0, 0, 0)
	Tab.BorderSizePixel = 0
	Tab.Position = UDim2.new(-0.101344608, 0, 0.0734693855 + (tabIndex * 0.1), 0)
	Tab.Size = UDim2.new(0, 238, 0, 41)
	Tab.ZIndex = 0
	
	local TabText = Instance.new("TextLabel")
	TabText.Name = "TabText"
	TabText.Parent = Tab
	TabText.BackgroundColor3 = Color3.fromRGB(20, 20, 27)
	TabText.BackgroundTransparency = 1.000
	TabText.BorderColor3 = Color3.fromRGB(0, 0, 0)
	TabText.BorderSizePixel = 0
	TabText.Position = UDim2.new(0.20475243, 0, -0.0119465152, 0)
	TabText.Size = UDim2.new(0, 214, 0, 41)
	TabText.Font = Enum.Font.GothamBold
	TabText.Text = tabName
	TabText.TextColor3 = Color3.fromRGB(255, 255, 255)
	TabText.TextSize = 14.000
	TabText.TextXAlignment = Enum.TextXAlignment.Left
	
	local TabImage = Instance.new("ImageLabel")
	TabImage.Name = "TabImage"
	TabImage.Parent = Tab
	TabImage.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
	TabImage.BackgroundTransparency = 1.000
	TabImage.BorderColor3 = Color3.fromRGB(0, 0, 0)
	TabImage.BorderSizePixel = 0
	TabImage.Position = UDim2.new(0.0798319355, 0, 0.243902445, 0)
	TabImage.Size = UDim2.new(0, 20, 0, 20)
	TabImage.Image = tabImage or "rbxassetid://97584948400851"
	
	-- Make tab clickable
	local TabButton = Instance.new("TextButton")
	TabButton.Parent = Tab
	TabButton.BackgroundTransparency = 1
	TabButton.Size = UDim2.new(1, 0, 1, 0)
	TabButton.Text = ""
	TabButton.ZIndex = 2
	
	TabButton.MouseButton1Click:Connect(function()
		self:SwitchTab(tabName)
	end)
	
	self.Tabs[tabName] = {
		Button = Tab,
		Cards = {}
	}
	
	table.insert(self.TabButtons, Tab)
	
	if not self.CurrentTab then
		self:SwitchTab(tabName)
	end
	
	return self.Tabs[tabName]
end

-- Switch between tabs
function SpareStackLib:SwitchTab(tabName)
	self.CurrentTab = tabName
	self.CategoryText.Text = tabName
	
	-- Update tab button appearances
	for name, tab in pairs(self.Tabs) do
		if name == tabName then
			tab.Button.BackgroundColor3 = Color3.fromRGB(28, 28, 35)
		else
			tab.Button.BackgroundColor3 = Color3.fromRGB(20, 20, 27)
		end
	end
	
	-- Show/hide cards
	for _, card in pairs(self.Cards) do
		if card:GetAttribute("Tab") == tabName then
			card.Visible = true
		else
			card.Visible = false
		end
	end
end

-- Create a card
function SpareStackLib:CreateCard(cardTitle, tabName)
	local Card = Instance.new("Frame")
	Card.Name = "Card"
	Card.Parent = self.CardHolder
	Card.AnchorPoint = Vector2.new(0.5, 0.5)
	Card.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
	Card.BackgroundTransparency = 1.000
	Card.BorderColor3 = Color3.fromRGB(0, 0, 0)
	Card.BorderSizePixel = 0
	Card.Position = UDim2.new(0.25, 0, 0.0900000036, 0)
	Card.Size = UDim2.new(0, 356, 0, 337)
	Card:SetAttribute("Tab", tabName)
	
	local Image_6 = Instance.new("ImageLabel")
	Image_6.Name = "Image_6"
	Image_6.Parent = Card
	Image_6.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
	Image_6.BackgroundTransparency = 1.000
	Image_6.BorderColor3 = Color3.fromRGB(0, 0, 0)
	Image_6.BorderSizePixel = 0
	Image_6.Position = UDim2.new(0.0449438207, 0, 0.0445103869, 0)
	Image_6.Size = UDim2.new(0, 20, 0, 20)
	Image_6.Image = "rbxassetid://97584948400851"
	
	local Background_1 = Instance.new("ImageLabel")
	Background_1.Name = "Background_1"
	Background_1.Parent = Card
	Background_1.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
	Background_1.BackgroundTransparency = 1.000
	Background_1.BorderColor3 = Color3.fromRGB(0, 0, 0)
	Background_1.BorderSizePixel = 0
	Background_1.Position = UDim2.new(0, 0, 0.148367956, 0)
	Background_1.Size = UDim2.new(0, 356, 0, 289)
	Background_1.ZIndex = 0
	Background_1.Image = "rbxassetid://79172856971491"
	
	local CardTitleLabel = Instance.new("TextLabel")
	CardTitleLabel.Name = "CardTitle"
	CardTitleLabel.Parent = Card
	CardTitleLabel.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
	CardTitleLabel.BackgroundTransparency = 1.000
	CardTitleLabel.BorderColor3 = Color3.fromRGB(0, 0, 0)
	CardTitleLabel.BorderSizePixel = 0
	CardTitleLabel.Position = UDim2.new(0.129213482, 0, 0, 0)
	CardTitleLabel.Size = UDim2.new(0, 310, 0, 50)
	CardTitleLabel.Font = Enum.Font.GothamBold
	CardTitleLabel.Text = cardTitle
	CardTitleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
	CardTitleLabel.TextSize = 14.000
	CardTitleLabel.TextXAlignment = Enum.TextXAlignment.Left
	
	local Placard = Instance.new("ImageLabel")
	Placard.Name = "Placard"
	Placard.Parent = Card
	Placard.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
	Placard.BackgroundTransparency = 1.000
	Placard.BorderColor3 = Color3.fromRGB(0, 0, 0)
	Placard.BorderSizePixel = 0
	Placard.Size = UDim2.new(0, 356, 0, 50)
	Placard.ZIndex = 0
	Placard.Image = "rbxassetid://91296368223791"
	
	-- Elements holder (invisible frame to hold toggles, sliders, etc)
	local ElementsHolder = Instance.new("Frame")
	ElementsHolder.Name = "ElementsHolder"
	ElementsHolder.Parent = Card
	ElementsHolder.BackgroundTransparency = 1
	ElementsHolder.Position = UDim2.new(0.0449438207, 0, 0.148367956, 0)
	ElementsHolder.Size = UDim2.new(0, 310, 0, 289)
	ElementsHolder.ClipsDescendants = false
	
	table.insert(self.Cards, Card)
	if self.Tabs[tabName] then
		table.insert(self.Tabs[tabName].Cards, Card)
	end
	
	local elementYPos = 0
	
	return {
		Card = Card,
		ElementsHolder = ElementsHolder,
		GetNextYPos = function()
			local current = elementYPos
			elementYPos = elementYPos + 0.15
			return current
		end,
		AddToggle = function(_, name, callback) return self:AddToggle(Card, ElementsHolder, name, callback, elementYPos) end,
		AddSlider = function(_, name, min, max, default, callback) 
			local yPos = elementYPos
			elementYPos = elementYPos + 0.15
			return self:AddSlider(Card, ElementsHolder, name, min, max, default, callback, yPos) 
		end,
		AddDropdown = function(_, name, options, callback) 
			local yPos = elementYPos
			elementYPos = elementYPos + 0.15
			return self:AddDropdown(Card, ElementsHolder, name, options, callback, yPos) 
		end,
	}
end

-- Add Toggle (Your original design)
function SpareStackLib:AddToggle(card, parent, name, callback, yPos)
	callback = callback or function() end
	yPos = yPos or 0
	
	local Title = Instance.new("TextLabel")
	Title.Name = "Title"
	Title.Parent = parent
	Title.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
	Title.BackgroundTransparency = 1.000
	Title.BorderColor3 = Color3.fromRGB(0, 0, 0)
	Title.BorderSizePixel = 0
	Title.Position = UDim2.new(0, 0, yPos, 0)
	Title.Size = UDim2.new(0, 310, 0, 50)
	Title.Font = Enum.Font.GothamBold
	Title.Text = name
	Title.TextColor3 = Color3.fromRGB(255, 255, 255)
	Title.TextSize = 14.000
	Title.TextXAlignment = Enum.TextXAlignment.Left
	
	local Settings_7 = Instance.new("ImageButton")
	Settings_7.Name = "Settings_7"
	Settings_7.Parent = Title
	Settings_7.AnchorPoint = Vector2.new(0.5, 0.5)
	Settings_7.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
	Settings_7.BackgroundTransparency = 1.000
	Settings_7.BorderColor3 = Color3.fromRGB(0, 0, 0)
	Settings_7.BorderSizePixel = 0
	Settings_7.Position = UDim2.new(0.889769733, 0, 0.492551893, 0)
	Settings_7.Size = UDim2.new(0, 15, 0, 15)
	Settings_7.Image = "rbxassetid://70543102142774"
	Settings_7.ImageColor3 = Color3.fromRGB(46, 46, 66)
	
	local Background_2 = Instance.new("TextButton")
	Background_2.Name = "Background_2"
	Background_2.Parent = Title
	Background_2.BackgroundColor3 = Color3.fromRGB(28, 48, 103)
	Background_2.BorderColor3 = Color3.fromRGB(0, 0, 0)
	Background_2.BorderSizePixel = 0
	Background_2.Position = UDim2.new(0.94193548, 0, 0.300000012, 0)
	Background_2.Size = UDim2.new(0, 35, 0, 20)
	Background_2.Font = Enum.Font.SourceSans
	Background_2.Text = ""
	Background_2.TextColor3 = Color3.fromRGB(0, 0, 0)
	Background_2.TextSize = 14.000
	
	local UICorner_8 = Instance.new("UICorner")
	UICorner_8.CornerRadius = UDim.new(1, 0)
	UICorner_8.Name = "UICorner_8"
	UICorner_8.Parent = Background_2
	
	local Orb = Instance.new("TextButton")
	Orb.Name = "Orb"
	Orb.Parent = Title
	Orb.BackgroundColor3 = Color3.fromRGB(51, 105, 255)
	Orb.BorderColor3 = Color3.fromRGB(0, 0, 0)
	Orb.BorderSizePixel = 0
	Orb.Position = UDim2.new(1, 0, 0.370000005, 0)
	Orb.Size = UDim2.new(0, 13, 0, 13)
	Orb.Font = Enum.Font.SourceSans
	Orb.Text = ""
	Orb.TextColor3 = Color3.fromRGB(0, 0, 0)
	Orb.TextSize = 14.000
	
	local UICorner_3_9 = Instance.new("UICorner")
	UICorner_3_9.CornerRadius = UDim.new(1, 0)
	UICorner_3_9.Name = "UICorner_3_9"
	UICorner_3_9.Parent = Orb
	
	local toggled = false
	local tweenInfo = TweenInfo.new(0.25, Enum.EasingStyle.Quint, Enum.EasingDirection.Out)
	
	local backgroundOnColor = Color3.fromRGB(21, 21, 28)
	local orbOnColor = Color3.fromRGB(37, 37, 57)
	local textOnColor = Color3.fromRGB(58, 58, 73)
	local textOffColor = Color3.fromRGB(255, 255, 255)
	local backgroundOffColor = Background_2.BackgroundColor3
	local orbOffColor = Orb.BackgroundColor3
	
	local function toggleOrb()
		toggled = not toggled
		local targetX = toggled and 0.958 or 1
		local currentY = Orb.Position.Y
		
		TweenService:Create(Orb, tweenInfo, {
			Position = UDim2.new(targetX, 0, currentY.Scale, currentY.Offset)
		}):Play()
		
		TweenService:Create(Background_2, tweenInfo, {
			BackgroundColor3 = toggled and backgroundOnColor or backgroundOffColor
		}):Play()
		
		TweenService:Create(Orb, tweenInfo, {
			BackgroundColor3 = toggled and orbOnColor or orbOffColor
		}):Play()
		
		TweenService:Create(Title, tweenInfo, {
			TextColor3 = toggled and textOnColor or textOffColor
		}):Play()
		
		callback(toggled)
	end
	
	Background_2.MouseButton1Click:Connect(toggleOrb)
	Orb.MouseButton1Click:Connect(toggleOrb)
	
	return {Toggle = toggleOrb}
end

-- Add Slider (Your original design)
function SpareStackLib:AddSlider(card, parent, name, min, max, default, callback, yPos)
	callback = callback or function() end
	min = min or 0
	max = max or 100
	default = default or 0
	yPos = yPos or 0.4
	
	local Title_4 = Instance.new("TextLabel")
	Title_4.Name = "Title_4"
	Title_4.Parent = parent
	Title_4.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
	Title_4.BackgroundTransparency = 1.000
	Title_4.BorderColor3 = Color3.fromRGB(0, 0, 0)
	Title_4.BorderSizePixel = 0
	Title_4.Position = UDim2.new(0, 0, yPos, 0)
	Title_4.Size = UDim2.new(0, 310, 0, 50)
	Title_4.Font = Enum.Font.GothamBold
	Title_4.Text = name
	Title_4.TextColor3 = Color3.fromRGB(255, 255, 255)
	Title_4.TextSize = 14.000
	Title_4.TextXAlignment = Enum.TextXAlignment.Left
	
	local Bar = Instance.new("Frame")
	Bar.Name = "Bar"
	Bar.Parent = Title_4
	Bar.AnchorPoint = Vector2.new(0.5, 0.5)
	Bar.BackgroundColor3 = Color3.fromRGB(21, 21, 27)
	Bar.BorderColor3 = Color3.fromRGB(0, 0, 0)
	Bar.BorderSizePixel = 0
	Bar.Position = UDim2.new(0.522580624, 0, 0.90843749, 0)
	Bar.Size = UDim2.new(0, 318, 0, 9)
	
	local UICorner_5_10 = Instance.new("UICorner")
	UICorner_5_10.Name = "UICorner_5_10"
	UICorner_5_10.Parent = Bar
	
	local Fill = Instance.new("Frame")
	Fill.Name = "Fill"
	Fill.Parent = Bar
	Fill.AnchorPoint = Vector2.new(0, 0.5)
	Fill.BackgroundColor3 = Color3.fromRGB(51, 105, 255)
	Fill.BorderColor3 = Color3.fromRGB(0, 0, 0)
	Fill.BorderSizePixel = 0
	Fill.Position = UDim2.new(0, 0, 0.5, 0)
	Fill.Size = UDim2.new(0, 30, 0, 9)
	Fill.ZIndex = 0
	
	local UICorner_6 = Instance.new("UICorner")
	UICorner_6.Name = "UICorner_6"
	UICorner_6.Parent = Fill
	
	local TextButton = Instance.new("TextButton")
	TextButton.Parent = Bar
	TextButton.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
	TextButton.BorderColor3 = Color3.fromRGB(0, 0, 0)
	TextButton.BorderSizePixel = 0
	TextButton.Position = UDim2.new(0.0534591191, 0, -0.111111112, 0)
	TextButton.Size = UDim2.new(0, 21, 0, 11)
	TextButton.ZIndex = 2
	TextButton.Font = Enum.Font.SourceSans
	TextButton.Text = ""
	TextButton.TextColor3 = Color3.fromRGB(0, 0, 0)
	TextButton.TextSize = 14.000
	
	local UICorner_7 = Instance.new("UICorner")
	UICorner_7.CornerRadius = UDim.new(1, 0)
	UICorner_7.Name = "UICorner_7"
	UICorner_7.Parent = TextButton
	
	local TextBox = Instance.new("TextBox")
	TextBox.Parent = Title_4
	TextBox.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
	TextBox.BackgroundTransparency = 1.000
	TextBox.BorderColor3 = Color3.fromRGB(0, 0, 0)
	TextBox.BorderSizePixel = 0
	TextBox.Position = UDim2.new(0.865576148, 0, 0.507343769, 0)
	TextBox.Size = UDim2.new(0, 52, 0, 11)
	TextBox.Font = Enum.Font.Gotham
	TextBox.Text = "0%"
	TextBox.TextColor3 = Color3.fromRGB(255, 255, 255)
	TextBox.TextSize = 14.000
	TextBox.TextXAlignment = Enum.TextXAlignment.Right
	
	local dragging = false
	
	local function UpdateSlider(mouseX)
		local barWidth = Bar.AbsoluteSize.X
		local knobWidth = TextButton.AbsoluteSize.X
		
		mouseX = math.clamp(mouseX, 0, barWidth)
		
		local currentY = TextButton.Position.Y
		TextButton.Position = UDim2.new(0, mouseX - knobWidth / 2, currentY.Scale, currentY.Offset)
		Fill.Size = UDim2.new(0, mouseX, 1, 0)
		
		local percent = (mouseX / barWidth)
		local value = min + (percent * (max - min))
		TextBox.Text = math.floor(value) .. (max == 100 and "%" or "")
		
		callback(math.floor(value))
	end
	
	TextButton.MouseButton1Down:Connect(function()
		dragging = true
		local mousePos = UIS:GetMouseLocation()
		local knobCenterX = TextButton.Position.X.Offset + TextButton.AbsoluteSize.X / 2
		local dragOffset = mousePos.X - (Bar.AbsolutePosition.X + knobCenterX)
	end)
	
	UIS.InputEnded:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 then
			dragging = false
		end
	end)
	
	UIS.InputChanged:Connect(function(input)
		if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
			local mouseX = input.Position.X - Bar.AbsolutePosition.X
			UpdateSlider(mouseX)
		end
	end)
	
	Bar.InputBegan:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 then
			local mouseX = input.Position.X - Bar.AbsolutePosition.X
			UpdateSlider(mouseX)
		end
	end)
	
	TextBox.FocusLost:Connect(function()
		local value = tonumber(TextBox.Text:match("%d+"))
		if not value then return end
		value = math.clamp(value, min, max)
		local barWidth = Bar.AbsoluteSize.X
		local percent = (value - min) / (max - min)
		local mouseX = percent * barWidth
		UpdateSlider(mouseX)
	end)
	
	-- Initialize at default value
	local initPercent = (default - min) / (max - min)
	UpdateSlider(initPercent * Bar.AbsoluteSize.X)
	
	return {SetValue = function(val) UpdateSlider(((val - min) / (max - min)) * Bar.AbsoluteSize.X) end}
end

-- Add Dropdown (Your original design - FIXED)
function SpareStackLib:AddDropdown(card, parent, name, options, callback, yPos)
	callback = callback or function() end
	options = options or {"Disabled", "Enabled"}
	yPos = yPos or 0.6
	
	local Dropdown = Instance.new("TextButton")
	Dropdown.Name = "Dropdown"
	Dropdown.Parent = parent
	Dropdown.BackgroundColor3 = Color3.fromRGB(20, 20, 27)
	Dropdown.BorderColor3 = Color3.fromRGB(0, 0, 0)
	Dropdown.BorderSizePixel = 0
	Dropdown.Position = UDim2.new(0, 0, yPos, 0)
	Dropdown.Size = UDim2.new(0, 327, 0, 36)
	Dropdown.Font = Enum.Font.Unknown
	Dropdown.Text = "  " .. options[1]
	Dropdown.TextColor3 = Color3.fromRGB(255, 255, 255)
	Dropdown.TextSize = 14.000
	Dropdown.TextXAlignment = Enum.TextXAlignment.Left
	
	local UIPadding_2 = Instance.new("UIPadding")
	UIPadding_2.Parent = Dropdown
	UIPadding_2.PaddingLeft = UDim.new(0, 10)
	
	-- FIXED: Create arrow as TextLabel instead of ImageLabel to avoid infinite yield
	local Arrow = Instance.new("TextLabel")
	Arrow.Name = "Arrow"
	Arrow.Parent = Dropdown
	Arrow.BackgroundTransparency = 1
	Arrow.Position = UDim2.new(0.883280754, 0, 0.222222224, 0)
	Arrow.Size = UDim2.new(0, 20, 0, 20)
	Arrow.Font = Enum.Font.GothamBold
	Arrow.Text = "â–¼"
	Arrow.TextColor3 = Color3.fromRGB(255, 255, 255)
	Arrow.TextSize = 14
	
	local UICorner_10 = Instance.new("UICorner")
	UICorner_10.CornerRadius = UDim.new(0, 3)
	UICorner_10.Parent = Dropdown
	
	local DropdownHolder = Instance.new("ScrollingFrame")
	DropdownHolder.Name = "DropdownHolder"
	DropdownHolder.Parent = parent
	DropdownHolder.Active = true
	DropdownHolder.BackgroundColor3 = Color3.fromRGB(20, 20, 27)
	DropdownHolder.BorderColor3 = Color3.fromRGB(0, 0, 0)
	DropdownHolder.BorderSizePixel = 0
	DropdownHolder.Position = UDim2.new(0, 0, yPos + 0.14, 0)
	DropdownHolder.Size = UDim2.new(0, 324, 0, 0)
	DropdownHolder.Visible = false
	DropdownHolder.ScrollBarThickness = 0
	DropdownHolder.ClipsDescendants = true
	DropdownHolder.ZIndex = 10
	
	local UICorner_11 = Instance.new("UICorner")
	UICorner_11.CornerRadius = UDim.new(0, 3)
	UICorner_11.Parent = DropdownHolder
	
	local UIListLayout = Instance.new("UIListLayout")
	UIListLayout.Parent = DropdownHolder
	UIListLayout.SortOrder = Enum.SortOrder.LayoutOrder
	UIListLayout.Padding = UDim.new(0, 10)
	
	local UIPadding_3 = Instance.new("UIPadding")
	UIPadding_3.Parent = DropdownHolder
	UIPadding_3.PaddingLeft = UDim.new(0, 24)
	UIPadding_3.PaddingTop = UDim.new(0, 15)
	
	local isOpen = false
	local tweenInfo = TweenInfo.new(0.3, Enum.EasingStyle.Quint, Enum.EasingDirection.Out)
	
	-- Create options
	for i, optionText in ipairs(options) do
		local Option = Instance.new("TextButton")
		Option.Name = "Option_" .. i
		Option.Parent = DropdownHolder
		Option.BackgroundColor3 = Color3.fromRGB(27, 27, 36)
		Option.BackgroundTransparency = i == 1 and 0 or 1
		Option.BorderColor3 = Color3.fromRGB(0, 0, 0)
		Option.BorderSizePixel = 0
		Option.Size = UDim2.new(0, 270, 0, 36)
		Option.Font = Enum.Font.Unknown
		Option.Text = "  " .. optionText
		Option.TextColor3 = Color3.fromRGB(255, 255, 255)
		Option.TextSize = 14.000
		Option.TextXAlignment = Enum.TextXAlignment.Left
		
		local UICorner = Instance.new("UICorner")
		UICorner.CornerRadius = UDim.new(0, 3)
		UICorner.Parent = Option
		
		local UIPadding = Instance.new("UIPadding")
		UIPadding.Parent = Option
		UIPadding.PaddingLeft = UDim.new(0, 10)
		
		Option.MouseButton1Click:Connect(function()
			Dropdown.Text = "  " .. optionText
			callback(optionText)
			
			-- Close dropdown
			isOpen = false
			DropdownHolder.Visible = false
			TweenService:Create(DropdownHolder, tweenInfo, {
				Size = UDim2.new(0, 324, 0, 0)
			}):Play()
			TweenService:Create(Arrow, tweenInfo, {
				Rotation = 0
			}):Play()
		end)
		
		Option.MouseEnter:Connect(function()
			TweenService:Create(Option, TweenInfo.new(0.2), {
				BackgroundTransparency = 0
			}):Play()
		end)
		
		Option.MouseLeave:Connect(function()
			TweenService:Create(Option, TweenInfo.new(0.2), {
				BackgroundTransparency = 1
			}):Play()
		end)
	end
	
	local dropdownHeight = #options * 46 + 20
	
	Dropdown.MouseButton1Click:Connect(function()
		isOpen = not isOpen
		
		if isOpen then
			DropdownHolder.Visible = true
			DropdownHolder.CanvasSize = UDim2.new(0, 0, 0, dropdownHeight)
			TweenService:Create(DropdownHolder, tweenInfo, {
				Size = UDim2.new(0, 324, 0, math.min(dropdownHeight, 178))
			}):Play()
			TweenService:Create(Arrow, tweenInfo, {
				Rotation = 180
			}):Play()
		else
			TweenService:Create(DropdownHolder, tweenInfo, {
				Size = UDim2.new(0, 324, 0, 0)
			}):Play()
			TweenService:Create(Arrow, tweenInfo, {
				Rotation = 0
			}):Play()
			task.wait(0.3)
			if not isOpen then
				DropdownHolder.Visible = false
			end
		end
	end)
	
	return {SetValue = function(val) Dropdown.Text = "  " .. val end}
end

return SpareStackLib
