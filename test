-- SpareStack UI Library
-- Fully responsive and modular UI system

local SpareStackLib = {}
SpareStackLib.__index = SpareStackLib

local TweenService = game:GetService("TweenService")
local UIS = game:GetService("UserInputService")
local Players = game:GetService("Players")

-- Create main window
function SpareStackLib:CreateWindow(title)
	local self = setmetatable({}, SpareStackLib)
	
	-- Main ScreenGui
	local Sparestack = Instance.new("ScreenGui")
	Sparestack.Name = "SpareStack"
	Sparestack.Parent = Players.LocalPlayer:WaitForChild("PlayerGui")
	Sparestack.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
	Sparestack.ResetOnSpawn = false
	
	-- Background
	local Background = Instance.new("Frame")
	Background.Name = "Background"
	Background.Parent = Sparestack
	Background.BackgroundColor3 = Color3.fromRGB(15, 15, 20)
	Background.BorderSizePixel = 0
	Background.AnchorPoint = Vector2.new(0.5, 0.5)
	Background.Position = UDim2.new(0.5, 0, 0.5, 0)
	Background.Size = UDim2.new(0.7, 0, 0.8, 0)
	
	local BackgroundCorner = Instance.new("UICorner")
	BackgroundCorner.CornerRadius = UDim.new(0, 8)
	BackgroundCorner.Parent = Background
	
	local BackgroundPadding = Instance.new("UIPadding")
	BackgroundPadding.Parent = Background
	BackgroundPadding.PaddingLeft = UDim.new(0.01, 0)
	BackgroundPadding.PaddingRight = UDim.new(0.01, 0)
	BackgroundPadding.PaddingTop = UDim.new(0.01, 0)
	BackgroundPadding.PaddingBottom = UDim.new(0.01, 0)
	
	-- Top Bar
	local TopBar = Instance.new("Frame")
	TopBar.Name = "TopBar"
	TopBar.Parent = Background
	TopBar.BackgroundTransparency = 1
	TopBar.Size = UDim2.new(1, 0, 0.08, 0)
	TopBar.Position = UDim2.new(0, 0, 0, 0)
	
	-- Title
	local TitleLabel = Instance.new("TextLabel")
	TitleLabel.Name = "Title"
	TitleLabel.Parent = TopBar
	TitleLabel.BackgroundTransparency = 1
	TitleLabel.Position = UDim2.new(0.25, 0, 0, 0)
	TitleLabel.Size = UDim2.new(0.3, 0, 1, 0)
	TitleLabel.Font = Enum.Font.GothamBold
	TitleLabel.Text = title or "SpareStack"
	TitleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
	TitleLabel.TextScaled = true
	TitleLabel.TextXAlignment = Enum.TextXAlignment.Left
	
	-- Search Box
	local SearchHolder = Instance.new("Frame")
	SearchHolder.Name = "SearchHolder"
	SearchHolder.Parent = TopBar
	SearchHolder.BackgroundTransparency = 1
	SearchHolder.Position = UDim2.new(0.25, 0, 0.15, 0)
	SearchHolder.Size = UDim2.new(0.2, 0, 0.7, 0)
	
	local Search = Instance.new("TextBox")
	Search.Name = "Search"
	Search.Parent = SearchHolder
	Search.BackgroundColor3 = Color3.fromRGB(20, 20, 27)
	Search.BorderSizePixel = 0
	Search.Size = UDim2.new(1, 0, 1, 0)
	Search.Font = Enum.Font.SourceSansSemibold
	Search.PlaceholderText = "Search . . ."
	Search.Text = ""
	Search.TextColor3 = Color3.fromRGB(255, 255, 255)
	Search.TextScaled = true
	Search.TextXAlignment = Enum.TextXAlignment.Left
	Search.ClearTextOnFocus = false
	
	local SearchPadding = Instance.new("UIPadding")
	SearchPadding.Parent = Search
	SearchPadding.PaddingLeft = UDim.new(0.05, 0)
	
	local SearchCorner = Instance.new("UICorner")
	SearchCorner.CornerRadius = UDim.new(0, 3)
	SearchCorner.Parent = Search
	
	-- Settings Button
	local Settings = Instance.new("TextButton")
	Settings.Name = "Settings"
	Settings.Parent = TopBar
	Settings.BackgroundColor3 = Color3.fromRGB(20, 20, 27)
	Settings.BorderSizePixel = 0
	Settings.Position = UDim2.new(0.93, 0, 0.15, 0)
	Settings.Size = UDim2.new(0.05, 0, 0.7, 0)
	Settings.Font = Enum.Font.SourceSans
	Settings.Text = "⚙"
	Settings.TextColor3 = Color3.fromRGB(255, 255, 255)
	Settings.TextScaled = true
	
	local SettingsCorner = Instance.new("UICorner")
	SettingsCorner.CornerRadius = UDim.new(0, 3)
	SettingsCorner.Parent = Settings
	
	-- Side Panel
	local SideHolder = Instance.new("Frame")
	SideHolder.Name = "SideHolder"
	SideHolder.Parent = Background
	SideHolder.BackgroundTransparency = 1
	SideHolder.Position = UDim2.new(0, 0, 0.1, 0)
	SideHolder.Size = UDim2.new(0.2, 0, 0.88, 0)
	
	-- Card Holder (Main content area)
	local CardHolder = Instance.new("ScrollingFrame")
	CardHolder.Name = "CardHolder"
	CardHolder.Parent = Background
	CardHolder.Active = true
	CardHolder.BackgroundTransparency = 1
	CardHolder.BorderSizePixel = 0
	CardHolder.Position = UDim2.new(0.22, 0, 0.1, 0)
	CardHolder.Size = UDim2.new(0.76, 0, 0.88, 0)
	CardHolder.ScrollBarThickness = 5
	CardHolder.CanvasSize = UDim2.new(0, 0, 0, 0)
	
	local CardLayout = Instance.new("UIListLayout")
	CardLayout.Parent = CardHolder
	CardLayout.SortOrder = Enum.SortOrder.LayoutOrder
	CardLayout.Padding = UDim.new(0.02, 0)
	
	local CardPadding = Instance.new("UIPadding")
	CardPadding.Parent = CardHolder
	CardPadding.PaddingTop = UDim.new(0.01, 0)
	
	-- Auto-update canvas size
	CardLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
		CardHolder.CanvasSize = UDim2.new(0, 0, 0, CardLayout.AbsoluteContentSize.Y + 20)
	end)
	
	self.Gui = Sparestack
	self.Background = Background
	self.SideHolder = SideHolder
	self.CardHolder = CardHolder
	self.SearchBox = Search
	self.Cards = {}
	self.Tabs = {}
	self.CurrentTab = nil
	
	-- Search functionality
	Search:GetPropertyChangedSignal("Text"):Connect(function()
		self:FilterCards(Search.Text:lower())
	end)
	
	return self
end

-- Filter cards based on search
function SpareStackLib:FilterCards(query)
	for _, card in pairs(self.Cards) do
		if query == "" then
			card.Visible = true
		else
			local cardTitle = card:FindFirstChild("CardTitle")
			if cardTitle and string.find(cardTitle.Text:lower(), query) then
				card.Visible = true
			else
				card.Visible = false
			end
		end
	end
end

-- Create a tab
function SpareStackLib:CreateTab(tabName, icon)
	local tabIndex = #self.Tabs + 1
	
	-- Tab Button
	local Tab = Instance.new("TextButton")
	Tab.Name = "Tab_" .. tabName
	Tab.Parent = self.SideHolder
	Tab.BackgroundColor3 = Color3.fromRGB(20, 20, 27)
	Tab.BorderSizePixel = 0
	Tab.Position = UDim2.new(0, 0, 0.08 * (tabIndex - 1), 0)
	Tab.Size = UDim2.new(1, 0, 0.07, 0)
	Tab.Font = Enum.Font.GothamBold
	Tab.Text = "  " .. tabName
	Tab.TextColor3 = Color3.fromRGB(255, 255, 255)
	Tab.TextScaled = true
	Tab.TextXAlignment = Enum.TextXAlignment.Left
	
	local TabCorner = Instance.new("UICorner")
	TabCorner.CornerRadius = UDim.new(0, 3)
	TabCorner.Parent = Tab
	
	local TabPadding = Instance.new("UIPadding")
	TabPadding.Parent = Tab
	TabPadding.PaddingLeft = UDim.new(0.05, 0)
	
	-- Tab click functionality
	Tab.MouseButton1Click:Connect(function()
		self:SwitchTab(tabName)
	end)
	
	self.Tabs[tabName] = {
		Button = Tab,
		Cards = {}
	}
	
	if not self.CurrentTab then
		self:SwitchTab(tabName)
	end
	
	return self.Tabs[tabName]
end

-- Switch between tabs
function SpareStackLib:SwitchTab(tabName)
	self.CurrentTab = tabName
	
	-- Update tab button appearances
	for name, tab in pairs(self.Tabs) do
		if name == tabName then
			tab.Button.BackgroundColor3 = Color3.fromRGB(30, 30, 40)
		else
			tab.Button.BackgroundColor3 = Color3.fromRGB(20, 20, 27)
		end
	end
	
	-- Show/hide cards
	for _, card in pairs(self.Cards) do
		if card:GetAttribute("Tab") == tabName then
			card.Visible = true
		else
			card.Visible = false
		end
	end
end

-- Create a card
function SpareStackLib:CreateCard(cardTitle, tabName)
	local Card = Instance.new("Frame")
	Card.Name = "Card_" .. cardTitle
	Card.Parent = self.CardHolder
	Card.BackgroundColor3 = Color3.fromRGB(18, 18, 24)
	Card.BorderSizePixel = 0
	Card.Size = UDim2.new(1, 0, 0, 0) -- Height auto-calculated
	Card:SetAttribute("Tab", tabName)
	
	local CardCorner = Instance.new("UICorner")
	CardCorner.CornerRadius = UDim.new(0, 8)
	CardCorner.Parent = Card
	
	local CardPadding = Instance.new("UIPadding")
	CardPadding.Parent = Card
	CardPadding.PaddingLeft = UDim.new(0.02, 0)
	CardPadding.PaddingRight = UDim.new(0.02, 0)
	CardPadding.PaddingTop = UDim.new(0.02, 0)
	CardPadding.PaddingBottom = UDim.new(0.02, 0)
	
	-- Card Title
	local CardTitleLabel = Instance.new("TextLabel")
	CardTitleLabel.Name = "CardTitle"
	CardTitleLabel.Parent = Card
	CardTitleLabel.BackgroundTransparency = 1
	CardTitleLabel.Size = UDim2.new(1, 0, 0, 30)
	CardTitleLabel.Font = Enum.Font.GothamBold
	CardTitleLabel.Text = cardTitle
	CardTitleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
	CardTitleLabel.TextSize = 16
	CardTitleLabel.TextXAlignment = Enum.TextXAlignment.Left
	
	-- Elements holder
	local ElementsHolder = Instance.new("Frame")
	ElementsHolder.Name = "ElementsHolder"
	ElementsHolder.Parent = Card
	ElementsHolder.BackgroundTransparency = 1
	ElementsHolder.Position = UDim2.new(0, 0, 0, 35)
	ElementsHolder.Size = UDim2.new(1, 0, 1, -35)
	
	local ElementsLayout = Instance.new("UIListLayout")
	ElementsLayout.Parent = ElementsHolder
	ElementsLayout.SortOrder = Enum.SortOrder.LayoutOrder
	ElementsLayout.Padding = UDim.new(0, 10)
	
	-- Auto-update card height
	ElementsLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
		Card.Size = UDim2.new(1, 0, 0, ElementsLayout.AbsoluteContentSize.Y + 50)
	end)
	
	table.insert(self.Cards, Card)
	if self.Tabs[tabName] then
		table.insert(self.Tabs[tabName].Cards, Card)
	end
	
	return {
		Card = Card,
		ElementsHolder = ElementsHolder,
		AddToggle = function(_, name, callback) return self:AddToggle(ElementsHolder, name, callback) end,
		AddSlider = function(_, name, min, max, default, callback) return self:AddSlider(ElementsHolder, name, min, max, default, callback) end,
		AddDropdown = function(_, name, options, callback) return self:AddDropdown(ElementsHolder, name, options, callback) end,
		AddButton = function(_, name, callback) return self:AddButton(ElementsHolder, name, callback) end,
	}
end

-- Add Toggle
function SpareStackLib:AddToggle(parent, name, callback)
	callback = callback or function() end
	
	local ToggleFrame = Instance.new("Frame")
	ToggleFrame.Name = "Toggle_" .. name
	ToggleFrame.Parent = parent
	ToggleFrame.BackgroundTransparency = 1
	ToggleFrame.Size = UDim2.new(1, 0, 0, 40)
	
	local ToggleLabel = Instance.new("TextLabel")
	ToggleLabel.Parent = ToggleFrame
	ToggleLabel.BackgroundTransparency = 1
	ToggleLabel.Size = UDim2.new(0.7, 0, 1, 0)
	ToggleLabel.Font = Enum.Font.Gotham
	ToggleLabel.Text = name
	ToggleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
	ToggleLabel.TextSize = 14
	ToggleLabel.TextXAlignment = Enum.TextXAlignment.Left
	
	-- Toggle Background
	local ToggleBg = Instance.new("TextButton")
	ToggleBg.Name = "Background"
	ToggleBg.Parent = ToggleFrame
	ToggleBg.BackgroundColor3 = Color3.fromRGB(21, 21, 28)
	ToggleBg.BorderSizePixel = 0
	ToggleBg.Position = UDim2.new(0.85, 0, 0.25, 0)
	ToggleBg.Size = UDim2.new(0, 45, 0, 20)
	ToggleBg.Text = ""
	
	local ToggleBgCorner = Instance.new("UICorner")
	ToggleBgCorner.CornerRadius = UDim.new(1, 0)
	ToggleBgCorner.Parent = ToggleBg
	
	-- Toggle Orb
	local ToggleOrb = Instance.new("Frame")
	ToggleOrb.Name = "Orb"
	ToggleOrb.Parent = ToggleBg
	ToggleOrb.BackgroundColor3 = Color3.fromRGB(37, 37, 57)
	ToggleOrb.BorderSizePixel = 0
	ToggleOrb.Position = UDim2.new(0.05, 0, 0.15, 0)
	ToggleOrb.Size = UDim2.new(0, 13, 0, 13)
	
	local ToggleOrbCorner = Instance.new("UICorner")
	ToggleOrbCorner.CornerRadius = UDim.new(1, 0)
	ToggleOrbCorner.Parent = ToggleOrb
	
	local toggled = false
	local tweenInfo = TweenInfo.new(0.25, Enum.EasingStyle.Quint, Enum.EasingDirection.Out)
	
	local function toggle()
		toggled = not toggled
		
		TweenService:Create(ToggleOrb, tweenInfo, {
			Position = toggled and UDim2.new(0.62, 0, 0.15, 0) or UDim2.new(0.05, 0, 0.15, 0)
		}):Play()
		
		TweenService:Create(ToggleBg, tweenInfo, {
			BackgroundColor3 = toggled and Color3.fromRGB(28, 48, 103) or Color3.fromRGB(21, 21, 28)
		}):Play()
		
		TweenService:Create(ToggleOrb, tweenInfo, {
			BackgroundColor3 = toggled and Color3.fromRGB(51, 105, 255) or Color3.fromRGB(37, 37, 57)
		}):Play()
		
		TweenService:Create(ToggleLabel, tweenInfo, {
			TextColor3 = toggled and Color3.fromRGB(51, 105, 255) or Color3.fromRGB(255, 255, 255)
		}):Play()
		
		callback(toggled)
	end
	
	ToggleBg.MouseButton1Click:Connect(toggle)
	
	return {
		Toggle = toggle,
		SetValue = function(value)
			if value ~= toggled then
				toggle()
			end
		end
	}
end

-- Add Slider
function SpareStackLib:AddSlider(parent, name, min, max, default, callback)
	callback = callback or function() end
	min = min or 0
	max = max or 100
	default = default or min
	
	local SliderFrame = Instance.new("Frame")
	SliderFrame.Name = "Slider_" .. name
	SliderFrame.Parent = parent
	SliderFrame.BackgroundTransparency = 1
	SliderFrame.Size = UDim2.new(1, 0, 0, 60)
	
	local SliderLabel = Instance.new("TextLabel")
	SliderLabel.Parent = SliderFrame
	SliderLabel.BackgroundTransparency = 1
	SliderLabel.Size = UDim2.new(0.7, 0, 0, 20)
	SliderLabel.Font = Enum.Font.Gotham
	SliderLabel.Text = name
	SliderLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
	SliderLabel.TextSize = 14
	SliderLabel.TextXAlignment = Enum.TextXAlignment.Left
	
	local ValueLabel = Instance.new("TextLabel")
	ValueLabel.Parent = SliderFrame
	ValueLabel.BackgroundTransparency = 1
	ValueLabel.Position = UDim2.new(0.7, 0, 0, 0)
	ValueLabel.Size = UDim2.new(0.3, 0, 0, 20)
	ValueLabel.Font = Enum.Font.Gotham
	ValueLabel.Text = tostring(default)
	ValueLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
	ValueLabel.TextSize = 14
	ValueLabel.TextXAlignment = Enum.TextXAlignment.Right
	
	-- Slider Bar
	local Bar = Instance.new("Frame")
	Bar.Name = "Bar"
	Bar.Parent = SliderFrame
	Bar.BackgroundColor3 = Color3.fromRGB(21, 21, 27)
	Bar.BorderSizePixel = 0
	Bar.Position = UDim2.new(0, 0, 0, 30)
	Bar.Size = UDim2.new(1, 0, 0, 9)
	
	local BarCorner = Instance.new("UICorner")
	BarCorner.CornerRadius = UDim.new(1, 0)
	BarCorner.Parent = Bar
	
	local Fill = Instance.new("Frame")
	Fill.Name = "Fill"
	Fill.Parent = Bar
	Fill.BackgroundColor3 = Color3.fromRGB(51, 105, 255)
	Fill.BorderSizePixel = 0
	Fill.Size = UDim2.new(0, 0, 1, 0)
	
	local FillCorner = Instance.new("UICorner")
	FillCorner.CornerRadius = UDim.new(1, 0)
	FillCorner.Parent = Fill
	
	local Knob = Instance.new("Frame")
	Knob.Name = "Knob"
	Knob.Parent = Bar
	Knob.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
	Knob.BorderSizePixel = 0
	Knob.Position = UDim2.new(0, 0, -0.3, 0)
	Knob.Size = UDim2.new(0, 15, 0, 15)
	Knob.ZIndex = 2
	
	local KnobCorner = Instance.new("UICorner")
	KnobCorner.CornerRadius = UDim.new(1, 0)
	KnobCorner.Parent = Knob
	
	local dragging = false
	
	local function updateSlider(value)
		value = math.clamp(value, min, max)
		local percent = (value - min) / (max - min)
		
		Fill.Size = UDim2.new(percent, 0, 1, 0)
		Knob.Position = UDim2.new(percent, -7.5, -0.3, 0)
		ValueLabel.Text = tostring(math.floor(value))
		
		callback(value)
	end
	
	local function getValueFromMouse(mouseX)
		local barPos = Bar.AbsolutePosition.X
		local barSize = Bar.AbsoluteSize.X
		local relativeX = math.clamp(mouseX - barPos, 0, barSize)
		local percent = relativeX / barSize
		return min + (percent * (max - min))
	end
	
	Knob.InputBegan:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 then
			dragging = true
		end
	end)
	
	UIS.InputEnded:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 then
			dragging = false
		end
	end)
	
	UIS.InputChanged:Connect(function(input)
		if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
			local value = getValueFromMouse(input.Position.X)
			updateSlider(value)
		end
	end)
	
	Bar.InputBegan:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 then
			local value = getValueFromMouse(input.Position.X)
			updateSlider(value)
		end
	end)
	
	updateSlider(default)
	
	return {
		SetValue = updateSlider
	}
end

-- Add Dropdown
function SpareStackLib:AddDropdown(parent, name, options, callback)
	callback = callback or function() end
	options = options or {"Option 1", "Option 2", "Option 3"}
	
	local DropdownFrame = Instance.new("Frame")
	DropdownFrame.Name = "Dropdown_" .. name
	DropdownFrame.Parent = parent
	DropdownFrame.BackgroundTransparency = 1
	DropdownFrame.Size = UDim2.new(1, 0, 0, 40)
	DropdownFrame.ClipsDescendants = false
	
	local DropdownLabel = Instance.new("TextLabel")
	DropdownLabel.Parent = DropdownFrame
	DropdownLabel.BackgroundTransparency = 1
	DropdownLabel.Size = UDim2.new(1, 0, 0, 20)
	DropdownLabel.Font = Enum.Font.Gotham
	DropdownLabel.Text = name
	DropdownLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
	DropdownLabel.TextSize = 14
	DropdownLabel.TextXAlignment = Enum.TextXAlignment.Left
	
	local DropdownButton = Instance.new("TextButton")
	DropdownButton.Name = "DropdownButton"
	DropdownButton.Parent = DropdownFrame
	DropdownButton.BackgroundColor3 = Color3.fromRGB(20, 20, 27)
	DropdownButton.BorderSizePixel = 0
	DropdownButton.Position = UDim2.new(0, 0, 0, 25)
	DropdownButton.Size = UDim2.new(1, 0, 0, 36)
	DropdownButton.Font = Enum.Font.Gotham
	DropdownButton.Text = "  " .. (options[1] or "Select")
	DropdownButton.TextColor3 = Color3.fromRGB(255, 255, 255)
	DropdownButton.TextSize = 14
	DropdownButton.TextXAlignment = Enum.TextXAlignment.Left
	
	local DropdownCorner = Instance.new("UICorner")
	DropdownCorner.CornerRadius = UDim.new(0, 3)
	DropdownCorner.Parent = DropdownButton
	
	local Arrow = Instance.new("TextLabel")
	Arrow.Parent = DropdownButton
	Arrow.BackgroundTransparency = 1
	Arrow.Position = UDim2.new(0.9, 0, 0, 0)
	Arrow.Size = UDim2.new(0.1, 0, 1, 0)
	Arrow.Font = Enum.Font.GothamBold
	Arrow.Text = "▼"
	Arrow.TextColor3 = Color3.fromRGB(255, 255, 255)
	Arrow.TextSize = 14
	
	local OptionsHolder = Instance.new("Frame")
	OptionsHolder.Name = "OptionsHolder"
	OptionsHolder.Parent = DropdownFrame
	OptionsHolder.BackgroundColor3 = Color3.fromRGB(20, 20, 27)
	OptionsHolder.BorderSizePixel = 0
	OptionsHolder.Position = UDim2.new(0, 0, 0, 66)
	OptionsHolder.Size = UDim2.new(1, 0, 0, 0)
	OptionsHolder.ClipsDescendants = true
	OptionsHolder.Visible = false
	OptionsHolder.ZIndex = 10
	
	local OptionsCorner = Instance.new("UICorner")
	OptionsCorner.CornerRadius = UDim.new(0, 3)
	OptionsCorner.Parent = OptionsHolder
	
	local OptionsList = Instance.new("UIListLayout")
	OptionsList.Parent = OptionsHolder
	OptionsList.SortOrder = Enum.SortOrder.LayoutOrder
	OptionsList.Padding = UDim.new(0, 5)
	
	local OptionsPadding = Instance.new("UIPadding")
	OptionsPadding.Parent = OptionsHolder
	OptionsPadding.PaddingLeft = UDim.new(0, 10)
	OptionsPadding.PaddingRight = UDim.new(0, 10)
	OptionsPadding.PaddingTop = UDim.new(0, 10)
	OptionsPadding.PaddingBottom = UDim.new(0, 10)
	
	local isOpen = false
	local tweenInfo = TweenInfo.new(0.3, Enum.EasingStyle.Quint, Enum.EasingDirection.Out)
	
	-- Create options
	for i, optionText in ipairs(options) do
		local OptionButton = Instance.new("TextButton")
		OptionButton.Name = "Option_" .. i
		OptionButton.Parent = OptionsHolder
		OptionButton.BackgroundColor3 = Color3.fromRGB(27, 27, 36)
		OptionButton.BackgroundTransparency = 1
		OptionButton.BorderSizePixel = 0
		OptionButton.Size = UDim2.new(1, -20, 0, 30)
		OptionButton.Font = Enum.Font.Gotham
		OptionButton.Text = "  " .. optionText
		OptionButton.TextColor3 = Color3.fromRGB(255, 255, 255)
		OptionButton.TextSize = 13
		OptionButton.TextXAlignment = Enum.TextXAlignment.Left
		
		local OptionCorner = Instance.new("UICorner")
		OptionCorner.CornerRadius = UDim.new(0, 3)
		OptionCorner.Parent = OptionButton
		
		OptionButton.MouseButton1Click:Connect(function()
			DropdownButton.Text = "  " .. optionText
			callback(optionText)
			
			-- Close dropdown
			isOpen = false
			OptionsHolder.Visible = false
			TweenService:Create(OptionsHolder, tweenInfo, {
				Size = UDim2.new(1, 0, 0, 0)
			}):Play()
			TweenService:Create(Arrow, tweenInfo, {
				Rotation = 0
			}):Play()
			TweenService:Create(DropdownFrame, tweenInfo, {
				Size = UDim2.new(1, 0, 0, 66)
			}):Play()
		end)
		
		OptionButton.MouseEnter:Connect(function()
			TweenService:Create(OptionButton, TweenInfo.new(0.2), {
				BackgroundTransparency = 0
			}):Play()
		end)
		
		OptionButton.MouseLeave:Connect(function()
			TweenService:Create(OptionButton, TweenInfo.new(0.2), {
				BackgroundTransparency = 1
			}):Play()
		end)
	end
	
	local optionsHeight = #options * 35 + 20
	
	DropdownButton.MouseButton1Click:Connect(function()
		isOpen = not isOpen
		
		if isOpen then
			OptionsHolder.Visible = true
			TweenService:Create(OptionsHolder, tweenInfo, {
				Size = UDim2.new(1, 0, 0, optionsHeight)
			}):Play()
			TweenService:Create(Arrow, tweenInfo, {
				Rotation = 180
			}):Play()
			TweenService:Create(DropdownFrame, tweenInfo, {
				Size = UDim2.new(1, 0, 0, 66 + optionsHeight + 5)
			}):Play()
		else
			TweenService:Create(OptionsHolder, tweenInfo, {
				Size = UDim2.new(1, 0, 0, 0)
			}):Play()
			TweenService:Create(Arrow, tweenInfo, {
				Rotation = 0
			}):Play()
			TweenService:Create(DropdownFrame, tweenInfo, {
				Size = UDim2.new(1, 0, 0, 66)
			}):Play()
			
			task.wait(0.3)
			if not isOpen then
				OptionsHolder.Visible = false
			end
		end
	end)
	
	return {
		SetValue = function(value)
			DropdownButton.Text = "  " .. value
		end
	}
end

-- Add Button
function SpareStackLib:AddButton(parent, name, callback)
	callback = callback or function() end
	
	local ButtonFrame = Instance.new("TextButton")
	ButtonFrame.Name = "Button_" .. name
	ButtonFrame.Parent = parent
	ButtonFrame.BackgroundColor3 = Color3.fromRGB(51, 105, 255)
	ButtonFrame.BorderSizePixel = 0
	ButtonFrame.Size = UDim2.new(1, 0, 0, 40)
	ButtonFrame.Font = Enum.Font.GothamBold
	ButtonFrame.Text = name
	ButtonFrame.TextColor3 = Color3.fromRGB(255, 255, 255)
	ButtonFrame.TextSize = 14
	
	local ButtonCorner = Instance.new("UICorner")
	ButtonCorner.CornerRadius = UDim.new(0, 5)
	ButtonCorner.Parent = ButtonFrame
	
	ButtonFrame.MouseButton1Click:Connect(function()
		callback()
		
		-- Click animation
		TweenService:Create(ButtonFrame, TweenInfo.new(0.1), {
			BackgroundColor3 = Color3.fromRGB(41, 85, 200)
		}):Play()
		task.wait(0.1)
		TweenService:Create(ButtonFrame, TweenInfo.new(0.1), {
			BackgroundColor3 = Color3.fromRGB(51, 105, 255)
		}):Play()
	end)
	
	return ButtonFrame
end

return SpareStackLib
