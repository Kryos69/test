-- Spare UI Library
-- 67

local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")

local Library = {}
Library.__index = Library

-- Utility function to create instances
local function createInstance(className, properties)
    local instance = Instance.new(className)
    for k, v in pairs(properties) do
        if typeof(k) ~= 'string' then
            continue
        end
        instance[k] = v
    end
    return instance
end

-- Tween utility
local function tween(object, properties, duration)
    duration = duration or 0.2
    local tweenInfo = TweenInfo.new(duration, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
    local tween = TweenService:Create(object, tweenInfo, properties)
    tween:Play()
    return tween
end

-- Create a new window
function Library:CreateWindow(config)
    config = config or {}
    local window = {}
    
    -- Main ScreenGui
    local ScreenGui = Instance.new("ScreenGui", game.Players.LocalPlayer.PlayerGui)
    ScreenGui.Name = config.Name or "SpareUI"
    ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    ScreenGui.ResetOnSpawn = false
    
    -- Background
    local Background = createInstance("ImageLabel", {
        Name = "Background",
        Position = UDim2.new(0.5, 0, 0.5, 0),
        Size = UDim2.new(0, 1011, 0, 630),
        AnchorPoint = Vector2.new(0.5, 0.5),
        Parent = ScreenGui,
        BackgroundTransparency = 1,
        BackgroundColor3 = Color3.fromRGB(255, 255, 255),
        ImageColor3 = Color3.fromRGB(255, 255, 255),
        Image = "rbxassetid://71105506054247",
        BorderSizePixel = 0,
        ZIndex = 0
    })
    
    local UIPadding = createInstance("UIPadding", {
        Parent = Background,
        PaddingLeft = UDim.new(0, 10)
    })
    
    -- Search holder
    local SearchHolder = createInstance("Frame", {
        Name = "SearchHolder",
        Position = UDim2.new(0.252, 0, 0.019, 0),
        Size = UDim2.new(0, 198, 0, 40),
        Parent = Background,
        BackgroundTransparency = 1,
        BackgroundColor3 = Color3.fromRGB(255, 255, 255),
        BorderSizePixel = 0,
        ZIndex = 1
    })
    
    local Search = createInstance("TextBox", {
        Name = "Search",
        Position = UDim2.new(-0.001, 0, -0.006, 0),
        Size = UDim2.new(0, 200, 0, 40),
        Parent = SearchHolder,
        Font = Enum.Font.SourceSansSemibold,
        Text = '',
        TextXAlignment = Enum.TextXAlignment.Left,
        TextYAlignment = Enum.TextYAlignment.Center,
        TextColor3 = Color3.fromRGB(255, 255, 255),
        PlaceholderText = 'Search . . .',
        PlaceholderColor3 = Color3.fromRGB(178, 178, 178),
        BackgroundColor3 = Color3.fromRGB(20, 20, 27),
        TextSize = 14,
        BorderSizePixel = 0,
        ZIndex = 1
    })
    
    createInstance("UIPadding", {
        Parent = Search,
        PaddingLeft = UDim.new(0, 15)
    })
    
    createInstance("UICorner", {
        Parent = Search,
        CornerRadius = UDim.new(0, 3)
    })
    
    createInstance("ImageLabel", {
        Name = "SearchIcon",
        Position = UDim2.new(0.805, 0, 0.300, 0),
        Size = UDim2.new(0, 15, 0, 15),
        Parent = Search,
        BackgroundTransparency = 1,
        BackgroundColor3 = Color3.fromRGB(255, 255, 255),
        ImageColor3 = Color3.fromRGB(255, 255, 255),
        Image = "rbxassetid://105544331892424",
        BorderSizePixel = 0,
        ZIndex = 1
    })
    
    createInstance("UICorner", {
        Parent = SearchHolder,
        CornerRadius = UDim.new(0, 3)
    })
    
    createInstance("UIStroke", {
        Parent = SearchHolder,
        Color = Color3.fromRGB(22, 22, 30),
        Thickness = 2,
        LineJoinMode = Enum.LineJoinMode.Round,
        Transparency = 0
    })
    
    -- Settings button
    local Settings = createInstance("TextButton", {
        Name = "Settings",
        Position = UDim2.new(0.930, 0, 0.017, 0),
        Size = UDim2.new(0, 45, 0, 45),
        Parent = Background,
        Font = Enum.Font.SourceSans,
        Text = '',
        BackgroundColor3 = Color3.fromRGB(20, 20, 27),
        TextSize = 14,
        BorderSizePixel = 0,
        ZIndex = 1
    })
    
    createInstance("UICorner", {
        Parent = Settings,
        CornerRadius = UDim.new(0, 3)
    })
    
    createInstance("ImageButton", {
        Name = "Image",
        Position = UDim2.new(0.256, 0, 0.284, 0),
        Size = UDim2.new(0, 20, 0, 20),
        Parent = Settings,
        BackgroundTransparency = 1,
        ImageColor3 = Color3.fromRGB(255, 255, 255),
        Image = "rbxassetid://70543102142774",
        BorderSizePixel = 0,
        ZIndex = 1
    })
    
    local uistroke = createInstance("Frame", {
        Name = "uistroke",
        Position = UDim2.new(0, 0, 0, 0),
        Size = UDim2.new(0, 45, 0, 45),
        Parent = Settings,
        BackgroundTransparency = 1,
        BorderSizePixel = 0,
        ZIndex = 1
    })
    
    createInstance("UIStroke", {
        Parent = uistroke,
        Color = Color3.fromRGB(22, 22, 30),
        Thickness = 2,
        LineJoinMode = Enum.LineJoinMode.Round,
        Transparency = 0
    })
    
    createInstance("UICorner", {
        Parent = uistroke,
        CornerRadius = UDim.new(0, 3)
    })
    
    -- Side decoration
    createInstance("ImageLabel", {
        Name = "SideDecoration",
        Position = UDim2.new(0.751, 0, 0.275, 0),
        Size = UDim2.new(0, 1011, 0, 630),
        Parent = ScreenGui,
        BackgroundTransparency = 1,
        ImageColor3 = Color3.fromRGB(255, 255, 255),
        Image = "rbxassetid://84404130442705",
        BorderSizePixel = 0,
        ZIndex = 0
    })
    
    -- Tab holder (left or right side)
    local TabHolder = createInstance("Frame", {
        Name = "TabHolder",
        Position = config.TabSide == "right" and UDim2.new(0.751, 0, 0.13, 0) or UDim2.new(0.02, 0, 0.13, 0),
        Size = UDim2.new(0, 200, 0, 500),
        Parent = Background,
        BackgroundTransparency = 1,
        BorderSizePixel = 0,
        ZIndex = 1
    })
    
    createInstance("UIListLayout", {
        Parent = TabHolder,
        SortOrder = Enum.SortOrder.LayoutOrder,
        Padding = UDim.new(0, 8)
    })
    
    -- Card holder (scrolling frame)
    local CardHolder = createInstance("ScrollingFrame", {
        Name = "CardHolder",
        Position = config.TabSide == "right" and UDim2.new(0.05, 0, 0.13, 0) or UDim2.new(0.25, 0, 0.13, 0),
        Size = UDim2.new(0, 700, 0, 520),
        Parent = Background,
        BackgroundTransparency = 1,
        ScrollBarThickness = 7,
        ScrollBarImageColor3 = Color3.fromRGB(51, 105, 255),
        CanvasSize = UDim2.new(0, 0, 0, 0),
        ClipsDescendants = true,
        BorderSizePixel = 0,
        ZIndex = 1
    })
    
    local CardLayout = createInstance("UIGridLayout", {
        Parent = CardHolder,
        SortOrder = Enum.SortOrder.LayoutOrder,
        CellSize = UDim2.new(0, 340, 0, 320),
        CellPadding = UDim2.new(0, 16, 0, 16),
        FillDirectionMaxCells = 2
    })
    
    -- Store tabs and categories
    window.Tabs = {}
    window.CurrentTab = nil
    window.ScreenGui = ScreenGui
    window.Background = Background
    window.TabHolder = TabHolder
    window.CardHolder = CardHolder
    window.CardLayout = CardLayout
    
    -- Search functionality
    Search:GetPropertyChangedSignal("Text"):Connect(function()
        local searchText = Search.Text:lower()
        for _, card in pairs(CardHolder:GetChildren()) do
            if card:IsA("Frame") then
                local title = card:FindFirstChild("CardTitle")
                if title then
                    if searchText == "" or title.Text:lower():find(searchText) then
                        card.Visible = true
                    else
                        card.Visible = false
                    end
                end
            end
        end
    end)
    
    -- Update canvas size when cards are added
    local function updateCanvasSize()
        CardHolder.CanvasSize = UDim2.new(0, 0, 0, CardLayout.AbsoluteContentSize.Y + 20)
    end
    
    CardLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(updateCanvasSize)
    
    -- Create tab function
    function window:CreateTab(config)
        config = config or {}
        local tab = {}
        tab.Name = config.Name or "Tab"
        tab.Icon = config.Icon or "rbxassetid://97584948400851"
        tab.Cards = {}
        
        -- Tab button
        local TabButton = createInstance("TextButton", {
            Name = tab.Name,
            Size = UDim2.new(1, 0, 0, 40),
            Parent = TabHolder,
            BackgroundColor3 = Color3.fromRGB(20, 20, 27),
            Font = Enum.Font.GothamSemibold,
            Text = tab.Name,
            TextXAlignment = Enum.TextXAlignment.Left,
            TextColor3 = Color3.fromRGB(178, 178, 178),
            TextSize = 14,
            BorderSizePixel = 0,
            ZIndex = 1
        })
        
        createInstance("UIPadding", {
            Parent = TabButton,
            PaddingLeft = UDim.new(0, 35)
        })
        
        createInstance("UICorner", {
            Parent = TabButton,
            CornerRadius = UDim.new(0, 6)
        })
        
        createInstance("ImageLabel", {
            Name = "Icon",
            Position = UDim2.new(0, 8, 0.5, 0),
            Size = UDim2.new(0, 18, 0, 18),
            AnchorPoint = Vector2.new(0, 0.5),
            Parent = TabButton,
            BackgroundTransparency = 1,
            ImageColor3 = Color3.fromRGB(178, 178, 178),
            Image = tab.Icon,
            BorderSizePixel = 0,
            ZIndex = 1
        })
        
        tab.Button = TabButton
        tab.Icon = TabButton.Icon
        
        -- Select tab function
        local function selectTab()
            -- Deselect all tabs
            for _, t in pairs(window.Tabs) do
                tween(t.Button, {BackgroundColor3 = Color3.fromRGB(20, 20, 27)})
                tween(t.Button, {TextColor3 = Color3.fromRGB(178, 178, 178)})
                tween(t.Icon, {ImageColor3 = Color3.fromRGB(178, 178, 178)})
                
                -- Hide all cards from this tab
                for _, card in pairs(t.Cards) do
                    card.Visible = false
                end
            end
            
            -- Select this tab
            tween(TabButton, {BackgroundColor3 = Color3.fromRGB(51, 105, 255)})
            tween(TabButton, {TextColor3 = Color3.fromRGB(255, 255, 255)})
            tween(tab.Icon, {ImageColor3 = Color3.fromRGB(255, 255, 255)})
            
            -- Show all cards from this tab
            for _, card in pairs(tab.Cards) do
                card.Visible = true
            end
            
            window.CurrentTab = tab
        end
        
        TabButton.MouseButton1Click:Connect(selectTab)
        
        -- Create category function
        function tab:CreateCategory(config)
            config = config or {}
            local category = {}
            category.Name = config.Name or "Category"
            category.Icon = config.Icon or "rbxassetid://97584948400851"
            
            -- Card
            local Card = createInstance("Frame", {
                Name = category.Name,
                Size = UDim2.new(0, 340, 0, 320),
                Parent = CardHolder,
                BackgroundTransparency = 1,
                BorderSizePixel = 0,
                ZIndex = 1,
                Visible = false,
                LayoutOrder = #tab.Cards
            })
            
            table.insert(tab.Cards, Card)
            
            -- Card icon
            createInstance("ImageLabel", {
                Name = "Icon",
                Position = UDim2.new(0.045, 0, 0.045, 0),
                Size = UDim2.new(0, 20, 0, 20),
                Parent = Card,
                BackgroundTransparency = 1,
                ImageColor3 = Color3.fromRGB(255, 255, 255),
                Image = category.Icon,
                BorderSizePixel = 0,
                ZIndex = 1
            })
            
            -- Card background
            createInstance("ImageLabel", {
                Name = "CardBackground",
                Position = UDim2.new(0, 0, 0.148, 0),
                Size = UDim2.new(0, 340, 0, 280),
                Parent = Card,
                BackgroundTransparency = 1,
                ImageColor3 = Color3.fromRGB(255, 255, 255),
                Image = "rbxassetid://79172856971491",
                BorderSizePixel = 0,
                ZIndex = 0
            })
            
            -- Card title
            createInstance("TextLabel", {
                Name = "CardTitle",
                Position = UDim2.new(0.129, 0, 0, 0),
                Size = UDim2.new(0, 310, 0, 50),
                Parent = Card,
                BackgroundTransparency = 1,
                Font = Enum.Font.GothamBold,
                Text = category.Name,
                TextXAlignment = Enum.TextXAlignment.Left,
                TextYAlignment = Enum.TextYAlignment.Center,
                TextColor3 = Color3.fromRGB(255, 255, 255),
                TextSize = 14,
                BorderSizePixel = 0,
                ZIndex = 1
            })
            
            -- Placard
            createInstance("ImageLabel", {
                Name = "Placard",
                Position = UDim2.new(0, 0, 0, 0),
                Size = UDim2.new(0, 340, 0, 50),
                Parent = Card,
                BackgroundTransparency = 1,
                ImageColor3 = Color3.fromRGB(255, 255, 255),
                Image = "rbxassetid://91296368223791",
                BorderSizePixel = 0,
                ZIndex = 0
            })
            
            -- Elements container
            local ElementsContainer = createInstance("Frame", {
                Name = "ElementsContainer",
                Position = UDim2.new(0, 0, 0.16, 0),
                Size = UDim2.new(1, 0, 0.84, 0),
                Parent = Card,
                BackgroundTransparency = 1,
                BorderSizePixel = 0,
                ZIndex = 1
            })
            
            createInstance("UIListLayout", {
                Parent = ElementsContainer,
                SortOrder = Enum.SortOrder.LayoutOrder,
                Padding = UDim.new(0, 5),
                HorizontalAlignment = Enum.HorizontalAlignment.Center
            })
            
            category.Card = Card
            category.ElementsContainer = ElementsContainer
            
            -- Create toggle
            function category:CreateToggle(config)
                config = config or {}
                local toggleState = config.Default or false
                
                local ToggleFrame = createInstance("Frame", {
                    Name = "Toggle",
                    Size = UDim2.new(0.95, 0, 0, 50),
                    Parent = ElementsContainer,
                    BackgroundTransparency = 1,
                    BorderSizePixel = 0,
                    ZIndex = 1
                })
                
                local ToggleLabel = createInstance("TextLabel", {
                    Name = "Label",
                    Position = UDim2.new(0.045, 0, 0, 0),
                    Size = UDim2.new(0.7, 0, 1, 0),
                    Parent = ToggleFrame,
                    BackgroundTransparency = 1,
                    Font = Enum.Font.GothamBold,
                    Text = config.Name or "Toggle",
                    TextXAlignment = Enum.TextXAlignment.Left,
                    TextYAlignment = Enum.TextYAlignment.Center,
                    TextColor3 = Color3.fromRGB(255, 255, 255),
                    TextSize = 14,
                    BorderSizePixel = 0,
                    ZIndex = 1
                })
                
                -- Settings icon (optional)
                if config.Settings then
                    createInstance("ImageButton", {
                        Name = "SettingsIcon",
                        Position = UDim2.new(0.75, 0, 0.5, 0),
                        Size = UDim2.new(0, 15, 0, 15),
                        AnchorPoint = Vector2.new(0.5, 0.5),
                        Parent = ToggleFrame,
                        BackgroundTransparency = 1,
                        ImageColor3 = Color3.fromRGB(46, 46, 66),
                        Image = "rbxassetid://70543102142774",
                        BorderSizePixel = 0,
                        ZIndex = 1
                    }).MouseButton1Click:Connect(config.Settings)
                end
                
                -- Toggle background
                local ToggleBackground = createInstance("TextButton", {
                    Name = "ToggleBackground",
                    Position = UDim2.new(0.85, 0, 0.3, 0),
                    Size = UDim2.new(0, 35, 0, 20),
                    Parent = ToggleFrame,
                    Font = Enum.Font.SourceSans,
                    Text = '',
                    BackgroundColor3 = toggleState and Color3.fromRGB(51, 105, 255) or Color3.fromRGB(28, 48, 103),
                    BorderSizePixel = 0,
                    ZIndex = 1
                })
                
                createInstance("UICorner", {
                    Parent = ToggleBackground,
                    CornerRadius = UDim.new(1, 0)
                })
                
                -- Toggle orb
                local ToggleOrb = createInstance("Frame", {
                    Name = "ToggleOrb",
                    Position = toggleState and UDim2.new(0.75, 0, 0.5, 0) or UDim2.new(0.25, 0, 0.5, 0),
                    Size = UDim2.new(0, 13, 0, 13),
                    AnchorPoint = Vector2.new(0.5, 0.5),
                    Parent = ToggleBackground,
                    BackgroundColor3 = Color3.fromRGB(255, 255, 255),
                    BorderSizePixel = 0,
                    ZIndex = 1
                })
                
                createInstance("UICorner", {
                    Parent = ToggleOrb,
                    CornerRadius = UDim.new(1, 0)
                })
                
                -- Toggle functionality
                ToggleBackground.MouseButton1Click:Connect(function()
                    toggleState = not toggleState
                    
                    tween(ToggleBackground, {
                        BackgroundColor3 = toggleState and Color3.fromRGB(51, 105, 255) or Color3.fromRGB(28, 48, 103)
                    })
                    
                    tween(ToggleOrb, {
                        Position = toggleState and UDim2.new(0.75, 0, 0.5, 0) or UDim2.new(0.25, 0, 0.5, 0)
                    })
                    
                    if config.Callback then
                        config.Callback(toggleState)
                    end
                end)
                
                return {
                    SetValue = function(value)
                        toggleState = value
                        tween(ToggleBackground, {
                            BackgroundColor3 = toggleState and Color3.fromRGB(51, 105, 255) or Color3.fromRGB(28, 48, 103)
                        })
                        tween(ToggleOrb, {
                            Position = toggleState and UDim2.new(0.75, 0, 0.5, 0) or UDim2.new(0.25, 0, 0.5, 0)
                        })
                    end
                }
            end
            
            -- Create slider
            function category:CreateSlider(config)
                config = config or {}
                local min = config.Min or 0
                local max = config.Max or 100
                local default = config.Default or min
                local increment = config.Increment or 1
                local currentValue = default
                
                local SliderFrame = createInstance("Frame", {
                    Name = "Slider",
                    Size = UDim2.new(0.95, 0, 0, 60),
                    Parent = ElementsContainer,
                    BackgroundTransparency = 1,
                    BorderSizePixel = 0,
                    ZIndex = 1
                })
                
                local SliderLabel = createInstance("TextLabel", {
                    Name = "Label",
                    Position = UDim2.new(0.045, 0, 0, 0),
                    Size = UDim2.new(0.7, 0, 0, 25),
                    Parent = SliderFrame,
                    BackgroundTransparency = 1,
                    Font = Enum.Font.GothamBold,
                    Text = config.Name or "Slider",
                    TextXAlignment = Enum.TextXAlignment.Left,
                    TextYAlignment = Enum.TextYAlignment.Center,
                    TextColor3 = Color3.fromRGB(255, 255, 255),
                    TextSize = 14,
                    BorderSizePixel = 0,
                    ZIndex = 1
                })
                
                local ValueLabel = createInstance("TextLabel", {
                    Name = "ValueLabel",
                    Position = UDim2.new(0.75, 0, 0, 0),
                    Size = UDim2.new(0.2, 0, 0, 25),
                    Parent = SliderFrame,
                    BackgroundTransparency = 1,
                    Font = Enum.Font.GothamBold,
                    Text = tostring(currentValue),
                    TextXAlignment = Enum.TextXAlignment.Right,
                    TextYAlignment = Enum.TextYAlignment.Center,
                    TextColor3 = Color3.fromRGB(178, 178, 178),
                    TextSize = 14,
                    BorderSizePixel = 0,
                    ZIndex = 1
                })
                
                -- Slider bar
                local SliderBar = createInstance("Frame", {
                    Name = "Bar",
                    Position = UDim2.new(0.5, 0, 0.7, 0),
                    Size = UDim2.new(0.9, 0, 0, 9),
                    AnchorPoint = Vector2.new(0.5, 0.5),
                    Parent = SliderFrame,
                    BackgroundColor3 = Color3.fromRGB(21, 21, 27),
                    BorderSizePixel = 0,
                    ZIndex = 1
                })
                
                createInstance("UICorner", {
                    Parent = SliderBar
                })
                
                -- Slider fill
                local SliderFill = createInstance("Frame", {
                    Name = "Fill",
                    Position = UDim2.new(0, 0, 0.5, 0),
                    Size = UDim2.new((currentValue - min) / (max - min), 0, 1, 0),
                    AnchorPoint = Vector2.new(0, 0.5),
                    Parent = SliderBar,
                    BackgroundColor3 = Color3.fromRGB(51, 105, 255),
                    BorderSizePixel = 0,
                    ZIndex = 2
                })
                
                createInstance("UICorner", {
                    Parent = SliderFill
                })
                
                -- Slider button
                local SliderButton = createInstance("TextButton", {
                    Name = "Button",
                    Position = UDim2.new((currentValue - min) / (max - min), 0, 0.5, 0),
                    Size = UDim2.new(0, 21, 0, 21),
                    AnchorPoint = Vector2.new(0.5, 0.5),
                    Parent = SliderBar,
                    Font = Enum.Font.SourceSans,
                    Text = '',
                    BackgroundColor3 = Color3.fromRGB(255, 255, 255),
                    BorderSizePixel = 0,
                    ZIndex = 3
                })
                
                createInstance("UICorner", {
                    Parent = SliderButton,
                    CornerRadius = UDim.new(1, 0)
                })
                
                -- Slider dragging
                local dragging = false
                
                SliderButton.MouseButton1Down:Connect(function()
                    dragging = true
                end)
                
                UserInputService.InputEnded:Connect(function(input)
                    if input.UserInputType == Enum.UserInputType.MouseButton1 then
                        dragging = false
                    end
                end)
                
                UserInputService.InputChanged:Connect(function(input)
                    if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
                        local mousePos = UserInputService:GetMouseLocation().X
                        local barPos = SliderBar.AbsolutePosition.X
                        local barSize = SliderBar.AbsoluteSize.X
                        local relative = math.clamp((mousePos - barPos) / barSize, 0, 1)
                        
                        currentValue = math.floor((min + (max - min) * relative) / increment + 0.5) * increment
                        currentValue = math.clamp(currentValue, min, max)
                        
                        SliderFill.Size = UDim2.new(relative, 0, 1, 0)
                        SliderButton.Position = UDim2.new(relative, 0, 0.5, 0)
                        ValueLabel.Text = tostring(currentValue)
                        
                        if config.Callback then
                            config.Callback(currentValue)
                        end
                    end
                end)
                
                return {
                    SetValue = function(value)
                        currentValue = math.clamp(value, min, max)
                        local relative = (currentValue - min) / (max - min)
                        SliderFill.Size = UDim2.new(relative, 0, 1, 0)
                        SliderButton.Position = UDim2.new(relative, 0, 0.5, 0)
                        ValueLabel.Text = tostring(currentValue)
                    end
                }
            end
            
            -- Create dropdown
            function category:CreateDropdown(config)
                config = config or {}
                local options = config.Options or {}
                local currentOption = config.Default or (options[1] or "None")
                local isOpen = false
                
                local DropdownFrame = createInstance("Frame", {
                    Name = "Dropdown",
                    Size = UDim2.new(0.95, 0, 0, 50),
                    Parent = ElementsContainer,
                    BackgroundTransparency = 1,
                    BorderSizePixel = 0,
                    ZIndex = 1,
                    ClipsDescendants = true
                })
                
                local DropdownLabel = createInstance("TextLabel", {
                    Name = "Label",
                    Position = UDim2.new(0.045, 0, 0, 0),
                    Size = UDim2.new(0.95, 0, 0, 25),
                    Parent = DropdownFrame,
                    BackgroundTransparency = 1,
                    Font = Enum.Font.GothamBold,
                    Text = config.Name or "Dropdown",
                    TextXAlignment = Enum.TextXAlignment.Left,
                    TextYAlignment = Enum.TextYAlignment.Center,
                    TextColor3 = Color3.fromRGB(255, 255, 255),
                    TextSize = 14,
                    BorderSizePixel = 0,
                    ZIndex = 1
                })
                
                -- Dropdown button
                local DropdownButton = createInstance("TextButton", {
                    Name = "Button",
                    Position = UDim2.new(0.045, 0, 0.55, 0),
                    Size = UDim2.new(0.9, 0, 0, 35),
                    Parent = DropdownFrame,
                    Font = Enum.Font.GothamSemibold,
                    Text = "  " .. currentOption,
                    TextXAlignment = Enum.TextXAlignment.Left,
                    TextColor3 = Color3.fromRGB(255, 255, 255),
                    BackgroundColor3 = Color3.fromRGB(20, 20, 27),
                    TextSize = 13,
                    BorderSizePixel = 0,
                    ZIndex = 2
                })
                
                createInstance("UICorner", {
                    Parent = DropdownButton,
                    CornerRadius = UDim.new(0, 4)
                })
                
                -- Dropdown arrow
                local Arrow = createInstance("TextLabel", {
                    Name = "Arrow",
                    Position = UDim2.new(0.9, 0, 0.5, 0),
                    Size = UDim2.new(0, 20, 0, 20),
                    AnchorPoint = Vector2.new(0.5, 0.5),
                    Parent = DropdownButton,
                    BackgroundTransparency = 1,
                    Font = Enum.Font.GothamBold,
                    Text = "â–¼",
                    TextColor3 = Color3.fromRGB(178, 178, 178),
                    TextSize = 10,
                    BorderSizePixel = 0,
                    ZIndex = 2
                })
                
                -- Options container
                local OptionsContainer = createInstance("Frame", {
                    Name = "Options",
                    Position = UDim2.new(0.045, 0, 1.05, 0),
                    Size = UDim2.new(0.9, 0, 0, 0),
                    Parent = DropdownFrame,
                    BackgroundColor3 = Color3.fromRGB(20, 20, 27),
                    BorderSizePixel = 0,
                    ZIndex = 3,
                    ClipsDescendants = true
                })
                
                createInstance("UICorner", {
                    Parent = OptionsContainer,
                    CornerRadius = UDim.new(0, 4)
                })
                
                createInstance("UIListLayout", {
                    Parent = OptionsContainer,
                    SortOrder = Enum.SortOrder.LayoutOrder,
                    Padding = UDim.new(0, 2)
                })
                
                -- Create option buttons
                for i, option in ipairs(options) do
                    local OptionButton = createInstance("TextButton", {
                        Name = "Option_" .. i,
                        Size = UDim2.new(1, 0, 0, 30),
                        Parent = OptionsContainer,
                        Font = Enum.Font.GothamSemibold,
                        Text = "  " .. option,
                        TextXAlignment = Enum.TextXAlignment.Left,
                        TextColor3 = Color3.fromRGB(178, 178, 178),
                        BackgroundColor3 = Color3.fromRGB(20, 20, 27),
                        TextSize = 12,
                        BorderSizePixel = 0,
                        ZIndex = 3
                    })
                    
                    OptionButton.MouseEnter:Connect(function()
                        tween(OptionButton, {BackgroundColor3 = Color3.fromRGB(51, 105, 255)})
                        tween(OptionButton, {TextColor3 = Color3.fromRGB(255, 255, 255)})
                    end)
                    
                    OptionButton.MouseLeave:Connect(function()
                        tween(OptionButton, {BackgroundColor3 = Color3.fromRGB(20, 20, 27)})
                        tween(OptionButton, {TextColor3 = Color3.fromRGB(178, 178, 178)})
                    end)
                    
                    OptionButton.MouseButton1Click:Connect(function()
                        currentOption = option
                        DropdownButton.Text = "  " .. currentOption
                        
                        -- Close dropdown
                        isOpen = false
                        tween(DropdownFrame, {Size = UDim2.new(0.95, 0, 0, 50)}, 0.2)
                        tween(OptionsContainer, {Size = UDim2.new(0.9, 0, 0, 0)}, 0.2)
                        tween(Arrow, {Rotation = 0}, 0.2)
                        
                        if config.Callback then
                            config.Callback(currentOption)
                        end
                    end)
                end
                
                -- Toggle dropdown
                DropdownButton.MouseButton1Click:Connect(function()
                    isOpen = not isOpen
                    
                    if isOpen then
                        local optionsHeight = #options * 32
                        tween(DropdownFrame, {Size = UDim2.new(0.95, 0, 0, 90 + optionsHeight)}, 0.2)
                        tween(OptionsContainer, {Size = UDim2.new(0.9, 0, 0, optionsHeight)}, 0.2)
                        tween(Arrow, {Rotation = 180}, 0.2)
                    else
                        tween(DropdownFrame, {Size = UDim2.new(0.95, 0, 0, 50)}, 0.2)
                        tween(OptionsContainer, {Size = UDim2.new(0.9, 0, 0, 0)}, 0.2)
                        tween(Arrow, {Rotation = 0}, 0.2)
                    end
                end)
                
                return {
                    SetValue = function(value)
                        if table.find(options, value) then
                            currentOption = value
                            DropdownButton.Text = "  " .. currentOption
                        end
                    end,
                    Refresh = function(newOptions)
                        options = newOptions
                        -- Clear old options
                        for _, child in pairs(OptionsContainer:GetChildren()) do
                            if child:IsA("TextButton") then
                                child:Destroy()
                            end
                        end
                        -- Recreate options
                        for i, option in ipairs(options) do
                            local OptionButton = createInstance("TextButton", {
                                Name = "Option_" .. i,
                                Size = UDim2.new(1, 0, 0, 30),
                                Parent = OptionsContainer,
                                Font = Enum.Font.GothamSemibold,
                                Text = "  " .. option,
                                TextXAlignment = Enum.TextXAlignment.Left,
                                TextColor3 = Color3.fromRGB(178, 178, 178),
                                BackgroundColor3 = Color3.fromRGB(20, 20, 27),
                                TextSize = 12,
                                BorderSizePixel = 0,
                                ZIndex = 3
                            })
                            
                            OptionButton.MouseButton1Click:Connect(function()
                                currentOption = option
                                DropdownButton.Text = "  " .. currentOption
                                isOpen = false
                                tween(DropdownFrame, {Size = UDim2.new(0.95, 0, 0, 50)}, 0.2)
                                tween(OptionsContainer, {Size = UDim2.new(0.9, 0, 0, 0)}, 0.2)
                                tween(Arrow, {Rotation = 0}, 0.2)
                                if config.Callback then
                                    config.Callback(currentOption)
                                end
                            end)
                        end
                    end
                }
            end
            
            -- Create button
            function category:CreateButton(config)
                config = config or {}
                
                local ButtonFrame = createInstance("TextButton", {
                    Name = "Button",
                    Size = UDim2.new(0.9, 0, 0, 40),
                    Parent = ElementsContainer,
                    Font = Enum.Font.GothamBold,
                    Text = config.Name or "Button",
                    TextColor3 = Color3.fromRGB(255, 255, 255),
                    BackgroundColor3 = Color3.fromRGB(51, 105, 255),
                    TextSize = 14,
                    BorderSizePixel = 0,
                    ZIndex = 1
                })
                
                createInstance("UICorner", {
                    Parent = ButtonFrame,
                    CornerRadius = UDim.new(0, 6)
                })
                
                ButtonFrame.MouseEnter:Connect(function()
                    tween(ButtonFrame, {BackgroundColor3 = Color3.fromRGB(41, 95, 245)})
                end)
                
                ButtonFrame.MouseLeave:Connect(function()
                    tween(ButtonFrame, {BackgroundColor3 = Color3.fromRGB(51, 105, 255)})
                end)
                
                ButtonFrame.MouseButton1Click:Connect(function()
                    if config.Callback then
                        config.Callback()
                    end
                end)
                
                return ButtonFrame
            end
            
            -- Create label
            function category:CreateLabel(config)
                config = config or {}
                
                local Label = createInstance("TextLabel", {
                    Name = "Label",
                    Size = UDim2.new(0.9, 0, 0, 30),
                    Parent = ElementsContainer,
                    BackgroundTransparency = 1,
                    Font = Enum.Font.Gotham,
                    Text = config.Text or "Label",
                    TextXAlignment = Enum.TextXAlignment.Left,
                    TextYAlignment = Enum.TextYAlignment.Center,
                    TextColor3 = Color3.fromRGB(178, 178, 178),
                    TextSize = 13,
                    BorderSizePixel = 0,
                    ZIndex = 1,
                    TextWrapped = true
                })
                
                return {
                    SetText = function(text)
                        Label.Text = text
                    end
                }
            end
            
            return category
        end
        
        table.insert(window.Tabs, tab)
        
        -- Select first tab by default
        if #window.Tabs == 1 then
            selectTab()
        end
        
        return tab
    end
    
    -- Make window draggable
    local dragging = false
    local dragInput, mousePos, framePos
    
    Background.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            mousePos = input.Position
            framePos = Background.Position
            
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                end
            end)
        end
    end)
    
    Background.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement then
            dragInput = input
        end
    end)
    
    UserInputService.InputChanged:Connect(function(input)
        if input == dragInput and dragging then
            local delta = input.Position - mousePos
            Background.Position = UDim2.new(
                framePos.X.Scale,
                framePos.X.Offset + delta.X,
                framePos.Y.Scale,
                framePos.Y.Offset + delta.Y
            )
        end
    end)
    
    return window
end

return Library
